!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;(t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Hydra=e()}}(function(){var e;return(function(){function e(t,r,n){function i(s,u){if(!r[s]){if(!t[s]){var f="function"==typeof require&&require;if(!u&&f)return f(s,!0);if(o)return o(s,!0);var c=Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){return i(t[s][1][e]||e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}return e})()({1:[function(e,t,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function e(t,r,n){return Function.prototype.apply.call(t,r,n)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function e(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function e(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function e(t){return t!=t};function u(){u.init.call(this)}t.exports=u,t.exports.once=function e(t,r){return new Promise(function(e,n){var i,o,s;function u(e){t.removeListener(r,f),n(e)}function f(){"function"==typeof t.removeListener&&t.removeListener("error",u),e([].slice.call(arguments))}g(t,r,f,{once:!0}),"error"!==r&&(i=t,o=u,s={once:!0},"function"==typeof i.on&&g(i,"error",o,s))})},u.EventEmitter=u,u.prototype._events=void 0,u.prototype._eventsCount=0,u.prototype._maxListeners=void 0;var f=10;function c(e){if("function"!=typeof e)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?u.defaultMaxListeners:e._maxListeners}function p(e,t,r,n){if(c(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=l(e))>0&&s.length>i&&!s.warned){s.warned=!0;var i,o,s,u,f=Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=e,f.type=t,f.count=s.length,u=f,console&&console.warn&&console.warn(u)}return e}function h(){if(!this.fired)return(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length)?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=h.bind(n);return i.listener=r,n.wrapFn=i,i}function m(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function e(t){for(var r=Array(t.length),n=0;n<r.length;++n)r[n]=t[n].listener||t[n];return r}(i):v(i,i.length)}function $(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function v(e,t){for(var r=Array(t),n=0;n<t;++n)r[n]=e[n];return r}function g(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,function i(o){n.once&&e.removeEventListener(t,i),r(o)});else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e)}Object.defineProperty(u,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(e){if("number"!=typeof e||e<0||s(e))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");f=e}}),u.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},u.prototype.setMaxListeners=function e(t){if("number"!=typeof t||t<0||s(t))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},u.prototype.getMaxListeners=function e(){return l(this)},u.prototype.emit=function e(t){for(var r=[],n=1;n<arguments.length;n++)r.push(arguments[n]);var i="error"===t,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){if(r.length>0&&(u=r[0]),u instanceof Error)throw u;var u,f=Error("Unhandled error."+(u?" ("+u.message+")":""));throw f.context=u,f}var c=s[t];if(void 0===c)return!1;if("function"==typeof c)o(c,this,r);else for(var l=c.length,p=v(c,l),n=0;n<l;++n)o(p[n],this,r);return!0},u.prototype.addListener=function e(t,r){return p(this,t,r,!1)},u.prototype.on=u.prototype.addListener,u.prototype.prependListener=function e(t,r){return p(this,t,r,!0)},u.prototype.once=function e(t,r){return c(r),this.on(t,d(this,t,r)),this},u.prototype.prependOnceListener=function e(t,r){return c(r),this.prependListener(t,d(this,t,r)),this},u.prototype.removeListener=function e(t,r){var n,i,o,s,u;if(c(r),void 0===(i=this._events)||void 0===(n=i[t]))return this;if(n===r||n.listener===r)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,n.listener||r));else if("function"!=typeof n){for(o=-1,s=n.length-1;s>=0;s--)if(n[s]===r||n[s].listener===r){u=n[s].listener,o=s;break}if(o<0)return this;0===o?n.shift():function e(t,r){for(;r+1<t.length;r++)t[r]=t[r+1];t.pop()}(n,o),1===n.length&&(i[t]=n[0]),void 0!==i.removeListener&&this.emit("removeListener",t,u||r)}return this},u.prototype.off=u.prototype.removeListener,u.prototype.removeAllListeners=function e(t){var r,n,i;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var o,s=Object.keys(n);for(i=0;i<s.length;++i)"removeListener"!==(o=s[i])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(r=n[t]))this.removeListener(t,r);else if(void 0!==r)for(i=r.length-1;i>=0;i--)this.removeListener(t,r[i]);return this},u.prototype.listeners=function e(t){return m(this,t,!0)},u.prototype.rawListeners=function e(t){return m(this,t,!1)},u.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):$.call(e,t)},u.prototype.listenerCount=$,u.prototype.eventNames=function e(){return this._eventsCount>0?n(this._events):[]}},{}],2:[function(e,t,r){"function"==typeof Object.create?t.exports=function e(t,r){r&&(t.super_=r,t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:t.exports=function e(t,r){if(r){t.super_=r;var n=function(){};n.prototype=r.prototype,t.prototype=new n,t.prototype.constructor=t}}},{}],3:[function(t,r,n){var i,o;i=this,o=function(){"use strict";function e(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}var t=Object.freeze({__proto__:null,blackman:function(e){for(var t=new Float32Array(e),r=2*Math.PI/(e-1),n=2*r,i=0;i<e/2;i++)t[i]=.42-.5*Math.cos(i*r)+.08*Math.cos(i*n);for(i=Math.ceil(e/2);i>0;i--)t[e-i]=t[i-1];return t},sine:function(e){for(var t=Math.PI/(e-1),r=new Float32Array(e),n=0;n<e;n++)r[n]=Math.sin(t*n);return r},hanning:function(e){for(var t=new Float32Array(e),r=0;r<e;r++)t[r]=.5-.5*Math.cos(2*Math.PI*r/(e-1));return t},hamming:function(e){for(var t=new Float32Array(e),r=0;r<e;r++)t[r]=.54-.46*Math.cos(2*Math.PI*(r/e-1));return t}}),r={};function n(e){for(;e%2==0&&e>1;)e/=2;return 1===e}function i(e,n){if("rect"!==n){if(""!==n&&n||(n="hanning"),r[n]||(r[n]={}),!r[n][e.length])try{r[n][e.length]=t[n](e.length)}catch(i){throw Error("Invalid windowing function")}e=function(e,t){for(var r=[],n=0;n<Math.min(e.length,t.length);n++)r[n]=e[n]*t[n];return r}(e,r[n][e.length])}return e}function o(e,t,r){for(var n=new Float32Array(e),i=0;i<n.length;i++)n[i]=i*t/r,n[i]=13*Math.atan(n[i]/1315.8)+3.5*Math.atan(Math.pow(n[i]/7518,2));return n}function s(e){return Float32Array.from(e)}function u(e){return 1125*Math.log(1+e/700)}function f(e,t,r){for(var n,i=new Float32Array(e+2),o=new Float32Array(e+2),s=u(0),f=(u(t/2)-s)/(e+1),c=Array(e+2),l=0;l<i.length;l++)i[l]=l*f,o[l]=700*(Math.exp((n=i[l])/1125)-1),c[l]=Math.floor((r+1)*o[l]/t);for(var p=Array(e),h=0;h<p.length;h++){for(p[h]=Array(r/2+1).fill(0),l=c[h];l<c[h+1];l++)p[h][l]=(l-c[h])/(c[h+1]-c[h]);for(l=c[h+1];l<c[h+2];l++)p[h][l]=(c[h+2]-l)/(c[h+2]-c[h+1])}return p}function c(e,t){for(var r=0,n=0,i=0;i<t.length;i++)r+=Math.pow(i,e)*Math.abs(t[i]),n+=t[i];return r/n}function l(e){var t=e.ampSpectrum,r=e.barkScale,n=e.numberOfBarkBands;if("object"!=typeof t||"object"!=typeof r)throw TypeError();var i=void 0===n?24:n,o=new Float32Array(i),s=0,u=t,f=new Int32Array(i+1);f[0]=0;for(var c=r[u.length-1]/i,l=1,p=0;p<u.length;p++)for(;r[p]>c;)f[l++]=p,c=l*r[u.length-1]/i;for(p=0,f[i]=u.length-1;p<i;p++){for(var h=0,d=f[p];d<f[p+1];d++)h+=u[d];o[p]=Math.pow(h,.23)}for(p=0;p<o.length;p++)s+=o[p];return{specific:o,total:s}}function p(e){var t=e.ampSpectrum;if("object"!=typeof t)throw TypeError();for(var r=new Float32Array(t.length),n=0;n<r.length;n++)r[n]=Math.pow(t[n],2);return r}function h(e){var t=e.ampSpectrum,r=e.melFilterBank,n=e.bufferSize;if("object"!=typeof t)throw TypeError("Valid ampSpectrum is required to generate melBands");if("object"!=typeof r)throw TypeError("Valid melFilterBank is required to generate melBands");for(var i=p({ampSpectrum:t}),o=r.length,s=Array(o),u=new Float32Array(o),f=0;f<u.length;f++){s[f]=new Float32Array(n/2),u[f]=0;for(var c=0;c<n/2;c++)s[f][c]=r[f][c]*i[c],u[f]+=s[f][c];u[f]=Math.log(u[f]+1)}return Array.prototype.slice.call(u)}var d,m,$={exports:{}},v=null,g=function(e,t){var r=e.length;return t=t||2,v&&v[r]||function(e){(v=v||{})[e]=Array(e*e);for(var t=Math.PI/e,r=0;r<e;r++)for(var n=0;n<e;n++)v[e][n+r*e]=Math.cos(t*(n+.5)*r)}(r),e.map(function(){return 0}).map(function(n,i){return t*e.reduce(function(e,t,n,o){return e+t*v[r][n+i*r]},0)})};(d=$).exports=g;var y=(m=$.exports)&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m,b=Object.freeze({__proto__:null,buffer:function(e){return e.signal},rms:function(e){var t=e.signal;if("object"!=typeof t)throw TypeError();for(var r=0,n=0;n<t.length;n++)r+=Math.pow(t[n],2);return r/=t.length,r=Math.sqrt(r)},energy:function(e){var t=e.signal;if("object"!=typeof t)throw TypeError();for(var r=0,n=0;n<t.length;n++)r+=Math.pow(Math.abs(t[n]),2);return r},complexSpectrum:function(e){return e.complexSpectrum},spectralSlope:function(e){var t=e.ampSpectrum,r=e.sampleRate,n=e.bufferSize;if("object"!=typeof t)throw TypeError();for(var i=0,o=0,s=new Float32Array(t.length),u=0,f=0,c=0;c<t.length;c++){i+=t[c];var l=c*r/n;s[c]=l,u+=l*l,o+=l,f+=l*t[c]}return(t.length*f-o*i)/(i*(u-Math.pow(o,2)))},spectralCentroid:function(e){var t=e.ampSpectrum;if("object"!=typeof t)throw TypeError();return c(1,t)},spectralRolloff:function(e){var t=e.ampSpectrum,r=e.sampleRate;if("object"!=typeof t)throw TypeError();for(var n=t,i=r/(2*(n.length-1)),o=0,s=0;s<n.length;s++)o+=n[s];for(var u=.99*o,f=n.length-1;o>u&&f>=0;)o-=n[f],--f;return(f+1)*i},spectralFlatness:function(e){var t=e.ampSpectrum;if("object"!=typeof t)throw TypeError();for(var r=0,n=0,i=0;i<t.length;i++)r+=Math.log(t[i]),n+=t[i];return Math.exp(r/t.length)*t.length/n},spectralSpread:function(e){var t=e.ampSpectrum;if("object"!=typeof t)throw TypeError();return Math.sqrt(c(2,t)-Math.pow(c(1,t),2))},spectralSkewness:function(e){var t=e.ampSpectrum;if("object"!=typeof t)throw TypeError();var r=c(1,t),n=c(2,t),i=c(3,t);return(2*Math.pow(r,3)-3*r*n+i)/Math.pow(Math.sqrt(n-Math.pow(r,2)),3)},spectralKurtosis:function(e){var t=e.ampSpectrum;if("object"!=typeof t)throw TypeError();var r=t,n=c(1,r),i=c(2,r),o=c(3,r),s=c(4,r);return(-3*Math.pow(n,4)+6*n*i-4*n*o+s)/Math.pow(Math.sqrt(i-Math.pow(n,2)),4)},amplitudeSpectrum:function(e){return e.ampSpectrum},zcr:function(e){var t=e.signal;if("object"!=typeof t)throw TypeError();for(var r=0,n=1;n<t.length;n++)(t[n-1]>=0&&t[n]<0||t[n-1]<0&&t[n]>=0)&&r++;return r},loudness:l,perceptualSpread:function(e){for(var t=l({ampSpectrum:e.ampSpectrum,barkScale:e.barkScale}),r=0,n=0;n<t.specific.length;n++)t.specific[n]>r&&(r=t.specific[n]);return Math.pow((t.total-r)/t.total,2)},perceptualSharpness:function(e){for(var t=l({ampSpectrum:e.ampSpectrum,barkScale:e.barkScale}),r=t.specific,n=0,i=0;i<r.length;i++)n+=i<15?(i+1)*r[i+1]:.066*Math.exp(.171*(i+1));return n*(.11/t.total)},powerSpectrum:p,mfcc:function(e){var t=e.ampSpectrum,r=e.melFilterBank,n=e.numberOfMFCCCoefficients,i=e.bufferSize,o=Math.min(40,Math.max(1,n||13));if(r.length<o)throw Error("Insufficient filter bank for requested number of coefficients");var s=h({ampSpectrum:t,melFilterBank:r,bufferSize:i});return y(s).slice(0,o)},chroma:function(e){var t=e.ampSpectrum,r=e.chromaFilterBank;if("object"!=typeof t)throw TypeError("Valid ampSpectrum is required to generate chroma");if("object"!=typeof r)throw TypeError("Valid chromaFilterBank is required to generate chroma");var n=r.map(function(e,r){return t.reduce(function(t,r,n){return t+r*e[n]},0)}),i=Math.max.apply(Math,n);return i?n.map(function(e){return e/i}):n},spectralFlux:function(e){var t=e.signal,r=e.previousSignal,n=e.bufferSize;if("object"!=typeof t||"object"!=typeof r)throw TypeError();for(var i=0,o=-n/2;o<t.length/2-1;o++)i+=((x=Math.abs(t[o])-Math.abs(r[o]))+Math.abs(x))/2;return i},spectralCrest:function(e){var t=e.ampSpectrum;if("object"!=typeof t)throw TypeError();var r=0,n=-1/0;return t.forEach(function(e){r+=Math.pow(e,2),n=e>n?e:n}),r/=t.length,n/(r=Math.sqrt(r))},melBands:h});function _(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var w={},S={},k={bitReverseArray:function(e){if(void 0===w[e]){for(var t=(e-1).toString(2).length,r="0".repeat(t),n={},i=0;i<e;i++){var o=i.toString(2);o=[].concat(_(o=r.substr(o.length)+o)).reverse().join(""),n[i]=parseInt(o,2)}w[e]=n}return w[e]},multiply:function(e,t){return{real:e.real*t.real-e.imag*t.imag,imag:e.real*t.imag+e.imag*t.real}},add:function(e,t){return{real:e.real+t.real,imag:e.imag+t.imag}},subtract:function(e,t){return{real:e.real-t.real,imag:e.imag-t.imag}},euler:function(e,t){var r=-2*Math.PI*e/t;return{real:Math.cos(r),imag:Math.sin(r)}},conj:function(e){return e.imag*=-1,e},constructComplexArray:function(e){var t={};t.real=void 0===e.real?e.slice():e.real.slice();var r=t.real.length;return void 0===S[r]&&(S[r]=Array.apply(null,Array(r)).map(Number.prototype.valueOf,0)),t.imag=S[r].slice(),t}},E=function(e){var t={};void 0===e.real||void 0===e.imag?t=k.constructComplexArray(e):(t.real=e.real.slice(),t.imag=e.imag.slice());var r=t.real.length,n=Math.log2(r);if(Math.round(n)!=n)throw Error("Input size must be a power of 2.");if(t.real.length!=t.imag.length)throw Error("Real and imaginary components must have the same length.");for(var i=k.bitReverseArray(r),o={real:[],imag:[]},s=0;s<r;s++)o.real[i[s]]=t.real[s],o.imag[i[s]]=t.imag[s];for(var u=0;u<r;u++)t.real[u]=o.real[u],t.imag[u]=o.imag[u];for(var f=1;f<=n;f++)for(var c=Math.pow(2,f),l=0;l<c/2;l++)for(var p=k.euler(l,c),h=0;h<r/c;h++){var d=c*h+l,m=c*h+l+c/2,$={real:t.real[d],imag:t.imag[d]},v={real:t.real[m],imag:t.imag[m]},g=k.multiply(p,v),y=k.subtract($,g);t.real[m]=y.real,t.imag[m]=y.imag;var b=k.add(g,$);t.real[d]=b.real,t.imag[d]=b.imag}return t},C=function(){function e(e,t){var r=this;if(this._m=t,!e.audioContext)throw this._m.errors.noAC;if(e.bufferSize&&!n(e.bufferSize))throw this._m._errors.notPow2;if(!e.source)throw this._m._errors.noSource;this._m.audioContext=e.audioContext,this._m.bufferSize=e.bufferSize||this._m.bufferSize||256,this._m.hopSize=e.hopSize||this._m.hopSize||this._m.bufferSize,this._m.sampleRate=e.sampleRate||this._m.audioContext.sampleRate||44100,this._m.callback=e.callback,this._m.windowingFunction=e.windowingFunction||"hanning",this._m.featureExtractors=b,this._m.EXTRACTION_STARTED=e.startImmediately||!1,this._m.channel="number"==typeof e.channel?e.channel:0,this._m.inputs=e.inputs||1,this._m.outputs=e.outputs||1,this._m.numberOfMFCCCoefficients=e.numberOfMFCCCoefficients||this._m.numberOfMFCCCoefficients||13,this._m.numberOfBarkBands=e.numberOfBarkBands||this._m.numberOfBarkBands||24,this._m.spn=this._m.audioContext.createScriptProcessor(this._m.bufferSize,this._m.inputs,this._m.outputs),this._m.spn.connect(this._m.audioContext.destination),this._m._featuresToExtract=e.featureExtractors||[],this._m.barkScale=o(this._m.bufferSize,this._m.sampleRate,this._m.bufferSize),this._m.melFilterBank=f(Math.max(this._m.melBands,this._m.numberOfMFCCCoefficients),this._m.sampleRate,this._m.bufferSize),this._m.inputData=null,this._m.previousInputData=null,this._m.frame=null,this._m.previousFrame=null,this.setSource(e.source),this._m.spn.onaudioprocess=function(e){var t;null!==r._m.inputData&&(r._m.previousInputData=r._m.inputData),r._m.inputData=e.inputBuffer.getChannelData(r._m.channel),r._m.previousInputData?((t=new Float32Array(r._m.previousInputData.length+r._m.inputData.length-r._m.hopSize)).set(r._m.previousInputData.slice(r._m.hopSize)),t.set(r._m.inputData,r._m.previousInputData.length-r._m.hopSize)):t=r._m.inputData,(function(e,t,r){if(e.length<t)throw Error("Buffer is too short for frame length");if(r<1)throw Error("Hop length cannot be less that 1");if(t<1)throw Error("Frame length cannot be less that 1");return Array(1+Math.floor((e.length-t)/r)).fill(0).map(function(n,i){return e.slice(i*r,i*r+t)})})(t,r._m.bufferSize,r._m.hopSize).forEach(function(e){r._m.frame=e;var t=r._m.extract(r._m._featuresToExtract,r._m.frame,r._m.previousFrame);"function"==typeof r._m.callback&&r._m.EXTRACTION_STARTED&&r._m.callback(t),r._m.previousFrame=r._m.frame})}}return e.prototype.start=function(e){this._m._featuresToExtract=e||this._m._featuresToExtract,this._m.EXTRACTION_STARTED=!0},e.prototype.stop=function(){this._m.EXTRACTION_STARTED=!1},e.prototype.setSource=function(e){this._m.source&&this._m.source.disconnect(this._m.spn),this._m.source=e,this._m.source.connect(this._m.spn)},e.prototype.setChannel=function(e){e<=this._m.inputs?this._m.channel=e:console.error("Channel ".concat(e," does not exist. Make sure you've provided a value for 'inputs' that is greater than ").concat(e," when instantiating the MeydaAnalyzer"))},e.prototype.get=function(e){return this._m.inputData?this._m.extract(e||this._m._featuresToExtract,this._m.inputData,this._m.previousInputData):null},e}(),T={audioContext:null,spn:null,bufferSize:512,sampleRate:44100,melBands:26,chromaBands:12,callback:null,windowingFunction:"hanning",featureExtractors:b,EXTRACTION_STARTED:!1,numberOfMFCCCoefficients:13,numberOfBarkBands:24,_featuresToExtract:[],windowing:i,_errors:{notPow2:Error("Meyda: Buffer size must be a power of 2, e.g. 64 or 512"),featureUndef:Error("Meyda: No features defined."),invalidFeatureFmt:Error("Meyda: Invalid feature format"),invalidInput:Error("Meyda: Invalid input."),noAC:Error("Meyda: No AudioContext specified."),noSource:Error("Meyda: No source node specified.")},createMeydaAnalyzer:function(e){return new C(e,Object.assign({},T))},listAvailableFeatureExtractors:function(){return Object.keys(this.featureExtractors)},extract:function(t,r,i){var u=this;if(!r||"object"!=typeof r)throw this._errors.invalidInput;if(!t)throw this._errors.featureUndef;if(!n(r.length))throw this._errors.notPow2;void 0!==this.barkScale&&this.barkScale.length==this.bufferSize||(this.barkScale=o(this.bufferSize,this.sampleRate,this.bufferSize)),void 0!==this.melFilterBank&&this.barkScale.length==this.bufferSize&&this.melFilterBank.length==this.melBands||(this.melFilterBank=f(Math.max(this.melBands,this.numberOfMFCCCoefficients),this.sampleRate,this.bufferSize)),void 0!==this.chromaFilterBank&&this.chromaFilterBank.length==this.chromaBands||(this.chromaFilterBank=function t(r,n,i,o,s,u,f){void 0===o&&(o=5),void 0===s&&(s=2),void 0===u&&(u=!0),void 0===f&&(f=440);var c=Math.floor(i/2)+1,l=Array(i).fill(0).map(function(e,t){var o,s;return r*(o=n*t/i,s=f,Math.log2(16*o/s))});l[0]=l[1]-1.5*r;var p,h,d,m=l.slice(1).map(function(e,t){return Math.max(e-l[t])},1).concat([1]),$=Math.round(r/2),v=Array(r).fill(0).map(function(e,t){return l.map(function(e){return(10*r+$+e-t)%r-$})}),g=v.map(function(e,t){return e.map(function(e,r){return Math.exp(-.5*Math.pow(2*v[t][r]/m[r],2))})});if(h=(p=g)[0].map(function(){return 0}),d=p.reduce(function(e,t){return t.forEach(function(t,r){e[r]+=Math.pow(t,2)}),e},h).map(Math.sqrt),g=p.map(function(e,t){return e.map(function(e,t){return e/(d[t]||1)})}),s){var y=l.map(function(e){return Math.exp(-.5*Math.pow((e/r-o)/s,2))});g=g.map(function(e){return e.map(function(e,t){return e*y[t]})})}return u&&(g=e(e([],g.slice(3),!0),g.slice(0,3),!0)),g.map(function(e){return e.slice(0,c)})}(this.chromaBands,this.sampleRate,this.bufferSize)),"buffer"in r&&void 0===r.buffer?this.signal=s(r):this.signal=r;var c=D(r,this.windowingFunction,this.bufferSize);if(this.signal=c.windowedSignal,this.complexSpectrum=c.complexSpectrum,this.ampSpectrum=c.ampSpectrum,i){var l=D(i,this.windowingFunction,this.bufferSize);this.previousSignal=l.windowedSignal,this.previousComplexSpectrum=l.complexSpectrum,this.previousAmpSpectrum=l.ampSpectrum}var p=function(e){return u.featureExtractors[e]({ampSpectrum:u.ampSpectrum,chromaFilterBank:u.chromaFilterBank,complexSpectrum:u.complexSpectrum,signal:u.signal,bufferSize:u.bufferSize,sampleRate:u.sampleRate,barkScale:u.barkScale,melFilterBank:u.melFilterBank,previousSignal:u.previousSignal,previousAmpSpectrum:u.previousAmpSpectrum,previousComplexSpectrum:u.previousComplexSpectrum,numberOfMFCCCoefficients:u.numberOfMFCCCoefficients,numberOfBarkBands:u.numberOfBarkBands})};if("object"==typeof t)return t.reduce(function(e,t){var r;return Object.assign({},e,((r={})[t]=p(t),r))},{});if("string"==typeof t)return p(t);throw this._errors.invalidFeatureFmt}},D=function(e,t,r){var n={};void 0===e.buffer?n.signal=s(e):n.signal=e,n.windowedSignal=i(n.signal,t),n.complexSpectrum=E(n.windowedSignal),n.ampSpectrum=new Float32Array(r/2);for(var o=0;o<r/2;o++)n.ampSpectrum[o]=Math.sqrt(Math.pow(n.complexSpectrum.real[o],2)+Math.pow(n.complexSpectrum.imag[o],2));return n};return"undefined"!=typeof window&&(window.Meyda=T),T},"object"==typeof n&&void 0!==r?r.exports=o():"function"==typeof e&&e.amd?e(o):(i="undefined"!=typeof globalThis?globalThis:i||self).Meyda=o()},{}],4:[function(e,t,r){(function(e){(function(){(function(){var r,n,i,o,s,u;"undefined"!=typeof performance&&null!==performance&&performance.now?t.exports=function(){return performance.now()}:null!=e&&e.hrtime?(t.exports=function(){return(r()-s)/1e6},n=e.hrtime,s=(o=(r=function(){var e;return 1e9*(e=n())[0]+e[1]})())-(u=1e9*e.uptime())):Date.now?(t.exports=function(){return Date.now()-i},i=Date.now()):(t.exports=function(){return new Date().getTime()-i},i=new Date().getTime())}).call(this)}).call(this)}).call(this,e("_process"))},{_process:5}],5:[function(e,t,r){var n,i,o,s=t.exports={};function u(){throw Error("setTimeout has not been defined")}function f(){throw Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===u||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(r){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:u}catch(e){n=u}try{i="function"==typeof clearTimeout?clearTimeout:f}catch(t){i=f}}();var l=[],p=!1,h=-1;function d(){p&&o&&(p=!1,o.length?l=o.concat(l):h=-1,l.length&&m())}function m(){if(!p){var e=c(d);p=!0;for(var t=l.length;t;){for(o=l,l=[];++h<t;)o&&o[h].run();h=-1,t=l.length}o=null,p=!1,function e(t){if(i===clearTimeout)return clearTimeout(t);if((i===f||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{return i(t)}catch(r){try{return i.call(null,t)}catch(n){return i.call(this,t)}}}(e)}}function $(e,t){this.fun=e,this.array=t}function v(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new $(e,t)),1!==l.length||p||c(m)},$.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=v,s.addListener=v,s.once=v,s.off=v,s.removeListener=v,s.removeAllListeners=v,s.emit=v,s.prependListener=v,s.prependOnceListener=v,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}},{}],6:[function(e,t,r){var n=e("inherits"),i=e("events").EventEmitter,o=e("right-now"),s=e("raf");function u(e){if(!(this instanceof u))return new u(e);this.running=!1,this.last=o(),this._frame=0,this._tick=this.tick.bind(this),e&&this.on("tick",e)}t.exports=u,n(u,i),u.prototype.start=function(){if(!this.running)return this.running=!0,this.last=o(),this._frame=s(this._tick),this},u.prototype.stop=function(){return this.running=!1,0!==this._frame&&s.cancel(this._frame),this._frame=0,this},u.prototype.tick=function(){this._frame=s(this._tick);var e=o(),t=e-this.last;this.emit("tick",t),this.last=e}},{events:1,inherits:2,raf:7,"right-now":9}],7:[function(e,t,r){(function(r){(function(){for(var n=e("performance-now"),i="undefined"==typeof window?r:window,o=["moz","webkit"],s="AnimationFrame",u=i["request"+s],f=i["cancel"+s]||i["cancelRequest"+s],c=0;!u&&c<o.length;c++)u=i[o[c]+"Request"+s],f=i[o[c]+"Cancel"+s]||i[o[c]+"CancelRequest"+s];if(!u||!f){var l=0,p=0,h=[],d=1e3/60;u=function(e){if(0===h.length){var t=n(),r=Math.max(0,d-(t-l));l=r+t,setTimeout(function(){var e=h.slice(0);h.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(l)}catch(r){setTimeout(function(){throw r},0)}},Math.round(r))}return h.push({handle:++p,callback:e,cancelled:!1}),p},f=function(e){for(var t=0;t<h.length;t++)h[t].handle===e&&(h[t].cancelled=!0)}}t.exports=function(e){return u.call(i,e)},t.exports.cancel=function(){f.apply(i,arguments)},t.exports.polyfill=function(e){e||(e=i),e.requestAnimationFrame=u,e.cancelAnimationFrame=f}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"performance-now":4}],8:[function(t,r,n){var i,o;i=this,o=function(){function e(e,t){this.id=L++,this.type=e,this.data=t}function t(e){return"["+(function e(t){if(0===t.length)return[];var r=t.charAt(0),n=t.charAt(t.length-1);if(1<t.length&&r===n&&('"'===r||"'"===r))return['"'+t.substr(1,t.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t))return e(t.substr(0,r.index)).concat(e(r[1])).concat(e(t.substr(r.index+r[0].length)));if(1===(r=t.split(".")).length)return['"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(n=0,t=[];n<r.length;++n)t=t.concat(e(r[n]));return t})(e).join("][")+"]"}function r(e){return"string"==typeof e?e.split():e}function n(e){return"string"==typeof e?document.querySelector(e):e}function i(e,t){for(var r=Array(e),n=0;n<e;++n)r[n]=t(n);return r}function o(e){var t,r;return t=(65535<e)<<4,e>>>=t,r=(255<e)<<3,e>>>=r,t|=r,r=(15<e)<<2,e>>>=r,(t|=r)|(r=(3<e)<<1)|e>>>r>>1}function s(){function e(e){a:{for(var t=16;268435456>=t;t*=16)if(e<=t){e=t;break a}e=0}return 0<(t=r[o(e)>>2]).length?t.pop():new ArrayBuffer(e)}function t(e){r[o(e.byteLength)>>2].push(e)}var r=i(8,function(){return[]});return{alloc:e,free:t,allocType:function(t,r){var n=null;switch(t){case 5120:n=new Int8Array(e(r),0,r);break;case 5121:n=new Uint8Array(e(r),0,r);break;case 5122:n=new Int16Array(e(2*r),0,r);break;case 5123:n=new Uint16Array(e(2*r),0,r);break;case 5124:n=new Int32Array(e(4*r),0,r);break;case 5125:n=new Uint32Array(e(4*r),0,r);break;case 5126:n=new Float32Array(e(4*r),0,r);break;default:return null}return n.length!==r?n.subarray(0,r):n},freeType:function(e){t(e.buffer)}}}function u(e){return!!e&&"object"==typeof e&&Array.isArray(e.shape)&&Array.isArray(e.stride)&&"number"==typeof e.offset&&e.shape.length===e.stride.length&&(Array.isArray(e.data)||I(e.data))}function f(e,t,r,n,i,o){for(var s=0;s<t;++s)for(var u=e[s],f=0;f<r;++f)for(var c=u[f],l=0;l<n;++l)i[o++]=c[l]}function c(e){return 0|H[Object.prototype.toString.call(e)]}function l(e,t){for(var r=0;r<t.length;++r)e[r]=t[r]}function p(e,t,r,n,i,o,s){for(var u=0,f=0;f<r;++f)for(var c=0;c<n;++c)e[u++]=t[i*f+o*c+s]}function h(e){for(var t=P.allocType(5123,e.length),r=0;r<e.length;++r)if(isNaN(e[r]))t[r]=65535;else if(1/0===e[r])t[r]=31744;else if(-1/0===e[r])t[r]=64512;else{V[0]=e[r];var n=G[0],i=n>>>31<<15,o=(n<<1>>>24)-127,n=n>>13&1023;t[r]=-24>o?i:-14>o?i+(n+1024>>-14-o):15<o?i+31744:i+(o+15<<10)+n}return t}function d(e){return Array.isArray(e)||I(e)}function m(e){return"[object "+e+"]"}function $(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function v(e){return!!(Array.isArray(e)&&0!==e.length&&d(e[0]))}function g(e){return Object.prototype.toString.call(e)}function y(e){if(!e)return!1;var t=g(e);return 0<=eo.indexOf(t)||$(e)||v(e)||u(e)}function b(e,t){36193===e.type?(e.data=h(t),P.freeType(t)):e.data=t}function _(e,t,r,n,i,o){if(e=void 0!==eu[e]?eu[e]:ee[e]*es[t],o&&(e*=6),i){for(n=0;1<=r;)n+=e*r*r,r/=2;return n}return e*r*n}function w(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function S(e){return Array.prototype.slice.call(e)}function k(e){return S(e).join("")}function E(e){return Array.isArray(e)||I(e)||u(e)}function C(e){return e.sort(function(e,t){return"viewport"===e?-1:"viewport"===t?1:e<t?-1:1})}function T(e,t,r,n){this.thisDep=e,this.contextDep=t,this.propDep=r,this.append=n}function D(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function A(e){return new T(!1,!1,!1,e)}function F(e,t){var r=e.type;return 0===r?(r=e.data.length,new T(!0,1<=r,2<=r,t)):4===r?(r=e.data,new T(r.thisDep,r.contextDep,r.propDep,t)):new T(3===r,2===r,1===r,t)}function z(e,t){for(var r=0;r<e.length;++r)if(e[r]===t)return r;return -1}var j=function(e,t){for(var r=Object.keys(t),n=0;n<r.length;++n)e[r[n]]=t[r[n]];return e},L=0,B={DynamicVariable:e,define:function(r,n){return new e(r,t(n+""))},isDynamic:function(t){return"function"==typeof t&&!t._reglType||t instanceof e},unbox:function(t,r){return"function"==typeof t?new e(0,t):t},accessor:t},M={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},R="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},P=s();P.zero=s();var O=function(e,t){var r=1;t.ext_texture_filter_anisotropic&&(r=e.getParameter(34047));var n=1,i=1;t.webgl_draw_buffers&&(n=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){o=e.createTexture(),e.bindTexture(3553,o),e.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var s=e.createFramebuffer();if(e.bindFramebuffer(36160,s),e.framebufferTexture2D(36160,36064,3553,o,0),e.bindTexture(3553,null),36053!==e.checkFramebufferStatus(36160))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=P.allocType(5126,4);e.readPixels(0,0,1,1,6408,5126,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(o),o=1===u[0]),P.freeType(u)}}return u=!0,u=e.createTexture(),s=P.allocType(5121,36),e.activeTexture(33984),e.bindTexture(34067,u),e.texImage2D(34069,0,6408,3,3,0,6408,5121,s),P.freeType(s),e.bindTexture(34067,null),e.deleteTexture(u),u=!e.getError(),{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter(function(e){return!!t[e]}),maxAnisotropic:r,maxDrawbuffers:n,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:u}},I=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},q=function(e){return Object.keys(e).map(function(t){return e[t]})},U={shape:function(e){for(var t=[];e.length;e=e[0])t.push(e.length);return t},flatten:function(e,t,r,n){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;switch(r=n||P.allocType(r,i),t.length){case 0:break;case 1:for(n=t[0],t=0;t<n;++t)r[t]=e[t];break;case 2:for(n=t[0],t=t[1],o=i=0;o<n;++o)for(var s=e[o],u=0;u<t;++u)r[i++]=s[u];break;case 3:f(e,t[0],t[1],t[2],r,0);break;default:!function e(t,r,n,i,o){for(var s=1,u=n+1;u<r.length;++u)s*=r[u];var c=r[n];if(4==r.length-n){var l=r[n+1],p=r[n+2];for(u=0,r=r[n+3];u<c;++u)f(t[u],l,p,r,i,o),o+=s}else for(u=0;u<c;++u)e(t[u],r,n+1,i,o),o+=s}(e,t,0,r,0)}return r}},H={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},W={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},N={dynamic:35048,stream:35040,static:35044},X=U.flatten,Y=U.shape,Q=[];Q[5120]=1,Q[5122]=2,Q[5124]=4,Q[5121]=1,Q[5123]=2,Q[5125]=4,Q[5126]=4;var K={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},V=new Float32Array(1),G=new Uint32Array(V.buffer),J=[9984,9986,9985,9987],Z=[0,6409,6410,6407,6408],ee={};ee[6409]=ee[6406]=ee[6402]=1,ee[34041]=ee[6410]=2,ee[6407]=ee[35904]=3,ee[6408]=ee[35906]=4;var et=m("HTMLCanvasElement"),er=m("CanvasRenderingContext2D"),en=m("ImageBitmap"),ei=m("HTMLImageElement"),ea=m("HTMLVideoElement"),eo=Object.keys(H).concat([et,er,en,ei,ea]),es=[];es[5121]=1,es[5126]=4,es[36193]=2,es[5123]=2,es[5125]=4;var eu=[];eu[32854]=2,eu[32855]=2,eu[36194]=2,eu[34041]=4,eu[33776]=.5,eu[33777]=.5,eu[33778]=1,eu[33779]=1,eu[35986]=.5,eu[35987]=1,eu[34798]=1,eu[35840]=.5,eu[35841]=.25,eu[35842]=.5,eu[35843]=.25,eu[36196]=.5;var ef=[];ef[32854]=2,ef[32855]=2,ef[36194]=2,ef[33189]=2,ef[36168]=1,ef[34041]=4,ef[35907]=4,ef[34836]=16,ef[34842]=8,ef[34843]=6;var ec=function(e,t,r,n,i){function o(e){this.id=c++,this.refCount=1,this.renderbuffer=e,this.format=32854,this.height=this.width=0,i.profile&&(this.stats={size:0})}function s(t){var r=t.renderbuffer;e.bindRenderbuffer(36161,null),e.deleteRenderbuffer(r),t.renderbuffer=null,t.refCount=0,delete l[t.id],n.renderbufferCount--}var u={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(u.srgba=35907),t.ext_color_buffer_half_float&&(u.rgba16f=34842,u.rgb16f=34843),t.webgl_color_buffer_float&&(u.rgba32f=34836);var f=[];Object.keys(u).forEach(function(e){f[u[e]]=e});var c=0,l={};return o.prototype.decRef=function(){0>=--this.refCount&&s(this)},i.profile&&(n.getTotalRenderbufferSize=function(){var e=0;return Object.keys(l).forEach(function(t){e+=l[t].stats.size}),e}),{create:function(t,r){function s(t,r){var n=0,o=0,l=32854;if("object"==typeof t&&t?("shape"in t?(n=0|(o=t.shape)[0],o=0|o[1]):("radius"in t&&(n=o=0|t.radius),"width"in t&&(n=0|t.width),"height"in t&&(o=0|t.height)),"format"in t&&(l=u[t.format])):"number"==typeof t?(n=0|t,o="number"==typeof r?0|r:n):t||(n=o=1),n!==c.width||o!==c.height||l!==c.format)return s.width=c.width=n,s.height=c.height=o,c.format=l,e.bindRenderbuffer(36161,c.renderbuffer),e.renderbufferStorage(36161,l,n,o),i.profile&&(c.stats.size=ef[c.format]*c.width*c.height),s.format=f[c.format],s}var c=new o(e.createRenderbuffer());return l[c.id]=c,n.renderbufferCount++,s(t,r),s.resize=function(t,r){var n=0|t,o=0|r||n;return n===c.width&&o===c.height||(s.width=c.width=n,s.height=c.height=o,e.bindRenderbuffer(36161,c.renderbuffer),e.renderbufferStorage(36161,c.format,n,o),i.profile&&(c.stats.size=ef[c.format]*c.width*c.height)),s},s._reglType="renderbuffer",s._renderbuffer=c,i.profile&&(s.stats=c.stats),s.destroy=function(){c.decRef()},s},clear:function(){q(l).forEach(s)},restore:function(){q(l).forEach(function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,t.renderbuffer),e.renderbufferStorage(36161,t.format,t.width,t.height)}),e.bindRenderbuffer(36161,null)}}},el=[];el[6408]=4,el[6407]=3;var ep=[];ep[5121]=1,ep[5126]=4,ep[36193]=2;var eh=["x","y","z","w"],ed="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),em={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},e$={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ev={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},eg={cw:2304,ccw:2305},ey=new T(!1,!1,!1,function(){}),eb=function(e,t){function r(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function n(e,t,n){var i=s.pop()||new r;i.startQueryIndex=e,i.endQueryIndex=t,i.sum=0,i.stats=n,u.push(i)}if(!t.ext_disjoint_timer_query)return null;var i=[],o=[],s=[],u=[],f=[],c=[];return{beginQuery:function(e){var r=i.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),o.push(r),n(o.length-1,o.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:n,update:function(){var e,r;if(0!==(e=o.length)){c.length=Math.max(c.length,e+1),f.length=Math.max(f.length,e+1),f[0]=0;var n=c[0]=0;for(r=e=0;r<o.length;++r){var l=o[r];t.ext_disjoint_timer_query.getQueryObjectEXT(l,34919)?(n+=t.ext_disjoint_timer_query.getQueryObjectEXT(l,34918),i.push(l)):o[e++]=l,f[r+1]=n,c[r+1]=e}for(o.length=e,r=e=0;r<u.length;++r){var n=u[r],p=n.startQueryIndex,l=n.endQueryIndex;n.sum+=f[l]-f[p],p=c[p],(l=c[l])===p?(n.stats.gpuTime+=n.sum/1e6,s.push(n)):(n.startQueryIndex=p,n.endQueryIndex=l,u[e++]=n)}u.length=e}},getNumPendingQueries:function(){return o.length},clear:function(){i.push.apply(i,o);for(var e=0;e<i.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(i[e]);o.length=0,i.length=0},restore:function(){o.length=0,i.length=0}}};return function(e){function t(){if(0===eB.length)e4&&e4.update(),eO=null;else{eO=M.next(t),es();for(var e=eB.length-1;0<=e;--e){var r=eB[e];r&&r(eC,null,0)}e_.flush(),e4&&e4.update()}}function o(){!eO&&0<eB.length&&(eO=M.next(t))}function s(){eO&&(M.cancel(t),eO=null)}function f(e){e.preventDefault(),s(),eM.forEach(function(e){e()})}function m(e){e_.getError(),e0.restore(),e5.restore(),eD.restore(),eF.restore(),e6.restore(),ez.restore(),e4&&e4.restore(),ej.procs.refresh(),o(),eR.forEach(function(e){e()})}function L(e){function t(e){var t={},r={};return Object.keys(e).forEach(function(n){var i=e[n];B.isDynamic(i)?r[n]=B.unbox(i,n):t[n]=i}),{dynamic:r,static:t}}var r=t(e.context||{}),n=t(e.uniforms||{}),i=t(e.attributes||{}),o=t(function(e){function t(e){if(e in r){var t=r[e];delete r[e],Object.keys(t).forEach(function(n){r[e+"."+n]=t[n]})}}var r=j({},e);return delete r.uniforms,delete r.attributes,delete r.context,"stencil"in r&&r.stencil.op&&(r.stencil.opBack=r.stencil.opFront=r.stencil.op,delete r.stencil.op),t("blend"),t("depth"),t("cull"),t("stencil"),t("polygonOffset"),t("scissor"),t("sample"),r}(e));e={gpuTime:0,cpuTime:0,count:0};var r=ej.compile(o,i,n,r,e),s=r.draw,u=r.batch,f=r.scope,c=[];return j(function(e,t){var r;if("function"==typeof e)return f.call(this,null,e,0);if("function"==typeof t){if("number"==typeof e)for(r=0;r<e;++r)f.call(this,null,t,r);else if(!Array.isArray(e))return f.call(this,e,t,0);else for(r=0;r<e.length;++r)f.call(this,e[r],t,r)}else if("number"==typeof e){if(0<e)return u.call(this,function e(t){for(;c.length<t;)c.push(null);return c}(0|e),0|e)}else if(!Array.isArray(e))return s.call(this,e);else if(e.length)return u.call(this,e,e.length)},{stats:e})}function V(e,t){var r=0;ej.procs.poll();var n=t.color;n&&(e_.clearColor(+n[0]||0,+n[1]||0,+n[2]||0,+n[3]||0),r|=16384),"depth"in t&&(e_.clearDepth(+t.depth),r|=256),"stencil"in t&&(e_.clearStencil(0|t.stencil),r|=1024),e_.clear(r)}function G(e){return eB.push(e),o(),{cancel:function(){function t(){eB[z(eB,t)]=eB[eB.length-1],--eB.length,0>=eB.length&&s()}eB[z(eB,e)]=t}}}function eo(){var e=eL.viewport,t=eL.scissor_box;e[0]=e[1]=t[0]=t[1]=0,eC.viewportWidth=eC.framebufferWidth=eC.drawingBufferWidth=e[2]=t[2]=e_.drawingBufferWidth,eC.viewportHeight=eC.framebufferHeight=eC.drawingBufferHeight=e[3]=t[3]=e_.drawingBufferHeight}function es(){eC.tick+=1,eC.time=ef(),eo(),ej.procs.poll()}function eu(){eo(),ej.procs.refresh(),e4&&e4.update()}function ef(){return(R()-eS)/1e3}if(!(e=function e(t){var i,o,s,u,f=t||{};t={};var c=[],l=[],p="undefined"==typeof window?1:window.devicePixelRatio,h=!1,d=function(e){},m=function(){};if("string"==typeof f?i=document.querySelector(f):"object"==typeof f&&("string"==typeof f.nodeName&&"function"==typeof f.appendChild&&"function"==typeof f.getBoundingClientRect?i=f:"function"==typeof f.drawArrays||"function"==typeof f.drawElements?s=(u=f).canvas:("gl"in f?u=f.gl:"canvas"in f?s=n(f.canvas):"container"in f&&(o=n(f.container)),"attributes"in f&&(t=f.attributes),"extensions"in f&&(c=r(f.extensions)),"optionalExtensions"in f&&(l=r(f.optionalExtensions)),"onDone"in f&&(d=f.onDone),"profile"in f&&(h=!!f.profile),"pixelRatio"in f&&(p=+f.pixelRatio))),i&&("canvas"===i.nodeName.toLowerCase()?s=i:o=i),!u){if(!s){if(!(i=function e(t,r,n){function i(){var e=window.innerWidth,r=window.innerHeight;t!==document.body&&(e=(r=t.getBoundingClientRect()).right-r.left,r=r.bottom-r.top),o.width=n*e,o.height=n*r,j(o.style,{width:e+"px",height:r+"px"})}var o=document.createElement("canvas");return j(o.style,{border:0,margin:0,padding:0,top:0,left:0}),t.appendChild(o),t===document.body&&(o.style.position="absolute",j(t.style,{margin:0,padding:0})),window.addEventListener("resize",i,!1),i(),{canvas:o,onDestroy:function(){window.removeEventListener("resize",i),t.removeChild(o)}}}(o||document.body,d,p)))return null;s=i.canvas,m=i.onDestroy}u=function e(t,r){function n(e){try{return t.getContext(e,r)}catch(n){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(s,t)}return u?{gl:u,canvas:s,container:o,extensions:c,optionalExtensions:l,pixelRatio:p,profile:h,onDone:d,onDestroy:m}:(m(),d("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}(e)))return null;var e_=e.gl,ex=e_.getContextAttributes();e_.isContextLost();var e0=function e(t,r){function n(e){var r;e=e.toLowerCase();try{r=i[e]=t.getExtension(e)}catch(n){}return!!r}for(var i={},o=0;o<r.extensions.length;++o){var s=r.extensions[o];if(!n(s))return r.onDestroy(),r.onDone('"'+s+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return r.optionalExtensions.forEach(n),{extensions:i,restore:function(){Object.keys(i).forEach(function(e){if(i[e]&&!n(e))throw Error("(regl): error restoring extension "+e)})}}}(e_,e);if(!e0)return null;var e1,e8,ew=(e1={"":0},e8=[""],{id:function(e){var t=e1[e];return t||(t=e1[e]=e8.length,e8.push(e)),t},str:function(e){return e8[e]}}),e2={bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},e3=e0.extensions,e4=eb(e_,e3),eS=R(),ek=e_.drawingBufferWidth,eE=e_.drawingBufferHeight,eC={tick:0,time:0,viewportWidth:ek,viewportHeight:eE,framebufferWidth:ek,framebufferHeight:eE,drawingBufferWidth:ek,drawingBufferHeight:eE,pixelRatio:e.pixelRatio},eT=O(e_,e3),ek=function e(t,r,n,i){for(r=Array(t=n.maxAttributes),n=0;n<t;++n)r[n]=new w;return{Record:w,scope:{},state:r}}(e_,e3,eT,ew),eD=function e(t,r,n,i){function o(e){this.id=d++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,n.profile&&(this.stats={size:0})}function s(e,r,n){e.byteLength=r.byteLength,t.bufferData(e.type,r,n)}function f(e,t,r,n,i,o){if(e.usage=r,Array.isArray(t)){if(e.dtype=n||5126,0<t.length){if(Array.isArray(t[0])){i=Y(t);for(var f=n=1;f<i.length;++f)n*=i[f];e.dimension=n,t=X(t,i,e.dtype),s(e,t,r),o?e.persistentData=t:P.freeType(t)}else"number"==typeof t[0]?(e.dimension=i,l(i=P.allocType(e.dtype,t.length),t),s(e,i,r),o?e.persistentData=i:P.freeType(i)):I(t[0])&&(e.dimension=t[0].length,e.dtype=n||c(t[0])||5126,t=X(t,[t.length,t[0].length],e.dtype),s(e,t,r),o?e.persistentData=t:P.freeType(t))}}else if(I(t))e.dtype=n||c(t),e.dimension=i,s(e,t,r),o&&(e.persistentData=new Uint8Array(new Uint8Array(t.buffer)));else if(u(t)){i=t.shape;var h=t.stride,f=t.offset,d=0,m=0,$=0,v=0;1===i.length?(d=i[0],m=1,$=h[0],v=0):2===i.length&&(d=i[0],m=i[1],$=h[0],v=h[1]),e.dtype=n||c(t.data)||5126,e.dimension=m,p(i=P.allocType(e.dtype,d*m),t.data,d,m,$,v,f),s(e,i,r),o?e.persistentData=i:P.freeType(i)}}function h(e){r.bufferCount--;for(var n=0;n<i.state.length;++n){var o=i.state[n];o.buffer===e&&(t.disableVertexAttribArray(n),o.buffer=null)}t.deleteBuffer(e.buffer),e.buffer=null,delete m[e.id]}var d=0,m={};o.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},o.prototype.destroy=function(){h(this)};var $=[];return n.profile&&(r.getTotalBufferSize=function(){var e=0;return Object.keys(m).forEach(function(t){e+=m[t].stats.size}),e}),{create:function(e,i,s,d){function $(e){var r=35044,i=null,o=0,s=0,c=1;return Array.isArray(e)||I(e)||u(e)?i=e:"number"==typeof e?o=0|e:e&&("data"in e&&(i=e.data),"usage"in e&&(r=N[e.usage]),"type"in e&&(s=W[e.type]),"dimension"in e&&(c=0|e.dimension),"length"in e&&(o=0|e.length)),v.bind(),i?f(v,i,r,s,c,d):(o&&t.bufferData(v.type,o,r),v.dtype=s||5121,v.usage=r,v.dimension=c,v.byteLength=o),n.profile&&(v.stats.size=v.byteLength*Q[v.dtype]),$}r.bufferCount++;var v=new o(i);return m[v.id]=v,s||$(e),$._reglType="buffer",$._buffer=v,$.subdata=function(e,r){var n,i=0|(r||0);if(v.bind(),I(e))t.bufferSubData(v.type,i,e);else if(Array.isArray(e)){if(0<e.length){if("number"==typeof e[0]){var o=P.allocType(v.dtype,e.length);l(o,e),t.bufferSubData(v.type,i,o),P.freeType(o)}else(Array.isArray(e[0])||I(e[0]))&&(n=Y(e),o=X(e,n,v.dtype),t.bufferSubData(v.type,i,o),P.freeType(o))}}else if(u(e)){n=e.shape;var s=e.stride,f=o=0,h=0,d=0;1===n.length?(o=n[0],f=1,h=s[0],d=0):2===n.length&&(o=n[0],f=n[1],h=s[0],d=s[1]),n=Array.isArray(e.data)?v.dtype:c(e.data),p(n=P.allocType(n,o*f),e.data,o,f,h,d,e.offset),t.bufferSubData(v.type,i,n),P.freeType(n)}return $},n.profile&&($.stats=v.stats),$.destroy=function(){h(v)},$},createStream:function(e,t){var r=$.pop();return r||(r=new o(e)),r.bind(),f(r,t,35040,0,1,!1),r},destroyStream:function(e){$.push(e)},clear:function(){q(m).forEach(h),$.forEach(h)},getBuffer:function(e){return e&&e._buffer instanceof o?e._buffer:null},restore:function(){q(m).forEach(function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)})},_initBuffer:f}}(e_,e2,e,ek),eA=function e(t,r,n,i){function o(e){this.id=l++,c[this.id]=this,this.buffer=e,this.primType=4,this.type=this.vertCount=0}function s(e,i,o,s,f,c,l){if(e.buffer.bind(),i){var p=l;l||I(i)&&(!u(i)||I(i.data))||(p=r.oes_element_index_uint?5125:5123),n._initBuffer(e.buffer,i,o,p,3)}else t.bufferData(34963,c,o),e.buffer.dtype=p||5121,e.buffer.usage=o,e.buffer.dimension=3,e.buffer.byteLength=c;if(p=l,!l){switch(e.buffer.dtype){case 5121:case 5120:p=5121;break;case 5123:case 5122:p=5123;break;case 5125:case 5124:p=5125}e.buffer.dtype=p}e.type=p,0>(i=f)&&(i=e.buffer.byteLength,5123===p?i>>=1:5125===p&&(i>>=2)),e.vertCount=i,i=s,0>s&&(i=4,1===(s=e.buffer.dimension)&&(i=0),2===s&&(i=1),3===s&&(i=4)),e.primType=i}function f(e){i.elementsCount--,delete c[e.id],e.buffer.destroy(),e.buffer=null}var c={},l=0,p={uint8:5121,uint16:5123};r.oes_element_index_uint&&(p.uint32=5125),o.prototype.bind=function(){this.buffer.bind()};var h=[];return{create:function(e,t){function r(e){if(e){if("number"==typeof e)c(e),l.primType=4,l.vertCount=0|e,l.type=5121;else{var t=null,n=35044,i=-1,o=-1,f=0,h=0;Array.isArray(e)||I(e)||u(e)?t=e:("data"in e&&(t=e.data),"usage"in e&&(n=N[e.usage]),"primitive"in e&&(i=K[e.primitive]),"count"in e&&(o=0|e.count),"type"in e&&(h=p[e.type]),"length"in e)?f=0|e.length:(f=o,5123===h||5122===h)?f*=2:(5125===h||5124===h)&&(f*=4),s(l,t,n,i,o,f,h)}}else c(),l.primType=4,l.vertCount=0,l.type=5121;return r}var c=n.create(null,34963,!0),l=new o(c._buffer);return i.elementsCount++,r(e),r._reglType="elements",r._elements=l,r.subdata=function(e,t){return c.subdata(e,t),r},r.destroy=function(){f(l)},r},createStream:function(e){var t=h.pop();return t||(t=new o(n.create(null,34963,!0,!1)._buffer)),s(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){h.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof o?e._elements:null},clear:function(){q(c).forEach(f)}}}(e_,e3,eD,e2),e5=function e(t,r,n,i){function o(e,t,r,n){this.name=e,this.id=t,this.location=r,this.info=n}function s(e,t){for(var r=0;r<e.length;++r)if(e[r].id===t.id){e[r].location=t.location;return}e.push(t)}function u(e,n,i){var o=(i=35632===e?l:p)[n];if(!o){var s=r.str(n),o=t.createShader(e);t.shaderSource(o,s),t.compileShader(o),i[n]=o}return o}function f(e,t){this.id=m++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function c(e,n){f=u(35632,e.fragId),c=u(35633,e.vertId);var f,c,l=e.program=t.createProgram();t.attachShader(l,f),t.attachShader(l,c),t.linkProgram(l);var p=t.getProgramParameter(l,35718);i.profile&&(e.stats.uniformsCount=p);var h=e.uniforms;for(f=0;f<p;++f)if(c=t.getActiveUniform(l,f)){if(1<c.size)for(var d=0;d<c.size;++d){var m=c.name.replace("[0]","["+d+"]");s(h,new o(m,r.id(m),t.getUniformLocation(l,m),c))}else s(h,new o(c.name,r.id(c.name),t.getUniformLocation(l,c.name),c))}for(p=t.getProgramParameter(l,35721),i.profile&&(e.stats.attributesCount=p),h=e.attributes,f=0;f<p;++f)(c=t.getActiveAttrib(l,f))&&s(h,new o(c.name,r.id(c.name),t.getAttribLocation(l,c.name),c))}var l={},p={},h={},d=[],m=0;return i.profile&&(n.getMaxUniformsCount=function(){var e=0;return d.forEach(function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)}),e},n.getMaxAttributesCount=function(){var e=0;return d.forEach(function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)}),e}),{clear:function(){var e=t.deleteShader.bind(t);q(l).forEach(e),l={},q(p).forEach(e),p={},d.forEach(function(e){t.deleteProgram(e.program)}),d.length=0,h={},n.shaderCount=0},program:function(e,t,r){var i=h[t];i||(i=h[t]={});var o=i[e];return o||(o=new f(t,e),n.shaderCount++,c(o,r),i[e]=o,d.push(o)),o},restore:function(){l={},p={};for(var e=0;e<d.length;++e)c(d[e])},shader:u,frag:-1,vert:-1}}(e_,ew,e2,e),eF=function e(t,r,n,i,o,s,f){function c(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function l(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function p(e,t){if("object"==typeof t&&t){"premultiplyAlpha"in t&&(e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(e.flipY=t.flipY),"alignment"in t&&(e.unpackAlignment=t.alignment),"colorSpace"in t&&(e.colorSpace=G[t.colorSpace]),"type"in t&&(e.type=eo[t.type]);var r=e.width,n=e.height,i=e.channels,o=!1;"shape"in t?(r=t.shape[0],n=t.shape[1],3===t.shape.length&&(i=t.shape[2],o=!0)):("radius"in t&&(r=n=t.radius),"width"in t&&(r=t.width),"height"in t&&(n=t.height),"channels"in t&&(i=t.channels,o=!0)),e.width=0|r,e.height=0|n,e.channels=0|i,r=!1,"format"in t&&(r=t.format,n=e.internalformat=es[r],e.format=e$[n],r in eo&&!("type"in t)&&(e.type=eo[r]),r in eu&&(e.compressed=!0),r=!0),!o&&r?e.channels=ee[e.format]:o&&!r&&e.channels!==Z[e.format]&&(e.format=e.internalformat=Z[e.channels])}}function m(e){t.pixelStorei(37440,e.flipY),t.pixelStorei(37441,e.premultiplyAlpha),t.pixelStorei(37443,e.colorSpace),t.pixelStorei(3317,e.unpackAlignment)}function w(){c.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function S(e,t){var r=null;if(y(t)?r=t:t&&(p(e,t),"x"in t&&(e.xOffset=0|t.x),"y"in t&&(e.yOffset=0|t.y),y(t.data)&&(r=t.data)),t.copy){var n=o.viewportWidth,i=o.viewportHeight;e.width=e.width||n-e.xOffset,e.height=e.height||i-e.yOffset,e.needsCopy=!0}else if(r){if(I(r))e.channels=e.channels||4,e.data=r,"type"in t||5121!==e.type||(e.type=0|H[Object.prototype.toString.call(r)]);else if($(r)){switch(e.channels=e.channels||4,i=(n=r).length,e.type){case 5121:case 5123:case 5125:case 5126:(i=P.allocType(e.type,i)).set(n),e.data=i;break;case 36193:e.data=h(n)}e.alignment=1,e.needsFree=!0}else if(u(r)){Array.isArray(n=r.data)||5121!==e.type||(e.type=0|H[Object.prototype.toString.call(n)]);var s,f,c,l,i=r.shape,m=r.stride;3===i.length?(c=i[2],l=m[2]):l=c=1,s=i[0],f=i[1],i=m[0],m=m[1],e.alignment=1,e.width=s,e.height=f,e.channels=c,e.format=e.internalformat=Z[c],e.needsFree=!0,s=l,r=r.offset,c=e.width,l=e.height,f=e.channels;for(var _=P.allocType(36193===e.type?5126:e.type,c*l*f),w=0,S=0;S<l;++S)for(var k=0;k<c;++k)for(var E=0;E<f;++E)_[w++]=n[i*k+m*S+s*E+r];b(e,_)}else if(g(r)===et||g(r)===er)g(r)===et?e.element=r:e.element=r.canvas,e.width=e.element.width,e.height=e.element.height,e.channels=4;else if(g(r)===en)e.element=r,e.width=r.width,e.height=r.height,e.channels=4;else if(g(r)===ei)e.element=r,e.width=r.naturalWidth,e.height=r.naturalHeight,e.channels=4;else if(g(r)===ea)e.element=r,e.width=r.videoWidth,e.height=r.videoHeight,e.channels=4;else if(v(r)){for(l=0,n=e.width||r[0].length,i=e.height||r.length,m=e.channels,m=d(r[0][0])?m||r[0][0].length:m||1,s=U.shape(r),c=1;l<s.length;++l)c*=s[l];c=P.allocType(36193===e.type?5126:e.type,c),U.flatten(r,s,"",c),b(e,c),e.alignment=1,e.width=n,e.height=i,e.channels=m,e.format=e.internalformat=Z[m],e.needsFree=!0}}else e.width=e.width||1,e.height=e.height||1,e.channels=e.channels||4}function k(e,r,n,o,s){var u=e.element,f=e.data,c=e.internalformat,l=e.format,p=e.type,h=e.width,d=e.height;m(e),u?t.texSubImage2D(r,s,n,o,l,p,u):e.compressed?t.compressedTexSubImage2D(r,s,n,o,c,h,d,f):e.needsCopy?(i(),t.copyTexSubImage2D(r,s,n,o,e.xOffset,e.yOffset,h,d)):t.texSubImage2D(r,s,n,o,h,d,l,p,f)}function E(){return ev.pop()||new w}function C(e){e.needsFree&&P.freeType(e.data),w.call(e),ev.push(e)}function T(){c.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function D(e,t,r){var n=e.images[0]=E();e.mipmask=1,n.width=e.width=t,n.height=e.height=r,n.channels=e.channels=4}function A(e,t){var r=null;if(y(t))l(r=e.images[0]=E(),e),S(r,t),e.mipmask=1;else if(p(e,t),Array.isArray(t.mipmap))for(var n=t.mipmap,i=0;i<n.length;++i)l(r=e.images[i]=E(),e),r.width>>=i,r.height>>=i,S(r,n[i]),e.mipmask|=1<<i;else l(r=e.images[0]=E(),e),S(r,t),e.mipmask=1;l(e,e.images[0])}function F(e,r){for(var n=e.images,o=0;o<n.length&&n[o];++o){var s=n[o],u=r,f=o,c=s.element,l=s.data,p=s.internalformat,h=s.format,d=s.type,$=s.width,v=s.height,g=s.channels;m(s),c?t.texImage2D(u,f,h,h,d,c):s.compressed?t.compressedTexImage2D(u,f,p,$,v,0,l):s.needsCopy?(i(),t.copyTexImage2D(u,f,h,s.xOffset,s.yOffset,$,v,0)):((s=!l)&&(l=P.zero.allocType(d,$*v*g)),t.texImage2D(u,f,h,$,v,0,h,d,l),s&&l&&P.zero.freeType(l))}}function z(){var e=eg.pop()||new T;c.call(e);for(var t=e.mipmask=0;16>t;++t)e.images[t]=null;return e}function L(e){for(var t=e.images,r=0;r<t.length;++r)t[r]&&C(t[r]),t[r]=null;eg.push(e)}function B(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function M(e,t){"min"in t&&(e.minFilter=V[t.min],!(0<=J.indexOf(e.minFilter))||"faces"in t||(e.genMipmaps=!0)),"mag"in t&&(e.magFilter=K[t.mag]);var r=e.wrapS,n=e.wrapT;if("wrap"in t){var i=t.wrap;"string"==typeof i?r=n=Q[i]:Array.isArray(i)&&(r=Q[i[0]],n=Q[i[1]])}else"wrapS"in t&&(r=Q[t.wrapS]),"wrapT"in t&&(n=Q[t.wrapT]);if(e.wrapS=r,e.wrapT=n,"anisotropic"in t&&(e.anisotropic=t.anisotropic),"mipmap"in t){switch(r=!1,typeof t.mipmap){case"string":e.mipmapHint=Y[t.mipmap],r=e.genMipmaps=!0;break;case"boolean":r=e.genMipmaps=t.mipmap;break;case"object":e.genMipmaps=!1,r=!0}!r||"min"in t||(e.minFilter=9984)}}function R(e,n){t.texParameteri(n,10241,e.minFilter),t.texParameteri(n,10240,e.magFilter),t.texParameteri(n,10242,e.wrapS),t.texParameteri(n,10243,e.wrapT),r.ext_texture_filter_anisotropic&&t.texParameteri(n,34046,e.anisotropic),e.genMipmaps&&(t.hint(33170,e.mipmapHint),t.generateMipmap(n))}function O(e){c.call(this),this.mipmask=0,this.internalformat=6408,this.id=ey++,this.refCount=1,this.target=e,this.texture=t.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new B,f.profile&&(this.stats={size:0})}function W(e){t.activeTexture(33984),t.bindTexture(e.target,e.texture)}function N(){var e=ex[0];e?t.bindTexture(e.target,e.texture):t.bindTexture(3553,null)}function X(e){var r=e.texture,n=e.unit,i=e.target;0<=n&&(t.activeTexture(33984+n),t.bindTexture(i,null),ex[n]=null),t.deleteTexture(r),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete eb[e.id],s.textureCount--}var Y={"don't care":4352,"dont care":4352,nice:4354,fast:4353},Q={repeat:10497,clamp:33071,mirror:33648},K={nearest:9728,linear:9729},V=j({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},K),G={none:0,browser:37444},eo={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},es={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},eu={};r.ext_srgb&&(es.srgb=35904,es.srgba=35906),r.oes_texture_float&&(eo.float32=eo.float=5126),r.oes_texture_half_float&&(eo.float16=eo["half float"]=36193),r.webgl_depth_texture&&(j(es,{depth:6402,"depth stencil":34041}),j(eo,{uint16:5123,uint32:5125,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&j(eu,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),r.webgl_compressed_texture_atc&&j(eu,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&j(eu,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(eu["rgb etc1"]=36196);var ef=Array.prototype.slice.call(t.getParameter(34467));Object.keys(eu).forEach(function(e){var t=eu[e];0<=ef.indexOf(t)&&(es[e]=t)});var ec=Object.keys(es);n.textureFormats=ec;var el=[];Object.keys(es).forEach(function(e){el[es[e]]=e});var ep=[];Object.keys(eo).forEach(function(e){ep[eo[e]]=e});var eh=[];Object.keys(K).forEach(function(e){eh[K[e]]=e});var ed=[];Object.keys(V).forEach(function(e){ed[V[e]]=e});var em=[];Object.keys(Q).forEach(function(e){em[Q[e]]=e});var e$=ec.reduce(function(e,t){var r=es[t];return 6409===r||6406===r||6409===r||6410===r||6402===r||34041===r?e[r]=r:32855===r||0<=t.indexOf("rgba")?e[r]=6408:e[r]=6407,e},{}),ev=[],eg=[],ey=0,eb={},e_=n.maxTextureUnits,ex=Array(e_).map(function(){return null});return j(O.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(0>e){for(var r=0;r<e_;++r){var n=ex[r];if(n){if(0<n.bindCount)continue;n.unit=-1}ex[r]=this,e=r;break}f.profile&&s.maxTextureUnits<e+1&&(s.maxTextureUnits=e+1),this.unit=e,t.activeTexture(33984+e),t.bindTexture(this.target,this.texture)}return e},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&X(this)}}),f.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(eb).forEach(function(t){e+=eb[t].stats.size}),e}),{create2D:function(e,r){function n(e,t){var r=i.texInfo;B.call(r);var o=z();return"number"==typeof e?"number"==typeof t?D(o,0|e,0|t):D(o,0|e,0|e):e?(M(r,e),A(o,e)):D(o,1,1),r.genMipmaps&&(o.mipmask=(o.width<<1)-1),i.mipmask=o.mipmask,l(i,o),i.internalformat=o.internalformat,n.width=o.width,n.height=o.height,W(i),F(o,3553),R(r,3553),N(),L(o),f.profile&&(i.stats.size=_(i.internalformat,i.type,o.width,o.height,r.genMipmaps,!1)),n.format=el[i.internalformat],n.type=ep[i.type],n.mag=eh[r.magFilter],n.min=ed[r.minFilter],n.wrapS=em[r.wrapS],n.wrapT=em[r.wrapT],n}var i=new O(3553);return eb[i.id]=i,s.textureCount++,n(e,r),n.subimage=function(e,t,r,o){t|=0,r|=0,o|=0;var s=E();return l(s,i),s.width=0,s.height=0,S(s,e),s.width=s.width||(i.width>>o)-t,s.height=s.height||(i.height>>o)-r,W(i),k(s,3553,t,r,o),N(),C(s),n},n.resize=function(e,r){var o=0|e,s=0|r||o;if(o===i.width&&s===i.height)return n;n.width=i.width=o,n.height=i.height=s,W(i);for(var u,c=i.channels,l=i.type,p=0;i.mipmask>>p;++p){var h=o>>p,d=s>>p;if(!h||!d)break;u=P.zero.allocType(l,h*d*c),t.texImage2D(3553,p,i.format,h,d,0,i.format,i.type,u),u&&P.zero.freeType(u)}return N(),f.profile&&(i.stats.size=_(i.internalformat,i.type,o,s,!1,!1)),n},n._reglType="texture2d",n._texture=i,f.profile&&(n.stats=i.stats),n.destroy=function(){i.decRef()},n},createCube:function(e,r,n,i,o,u){function c(e,t,r,n,i,o){var s,u=h.texInfo;for(B.call(u),s=0;6>s;++s)d[s]=z();if("number"!=typeof e&&e){if("object"==typeof e){if(t)A(d[0],e),A(d[1],t),A(d[2],r),A(d[3],n),A(d[4],i),A(d[5],o);else if(M(u,e),p(h,e),"faces"in e)for(e=e.faces,s=0;6>s;++s)l(d[s],h),A(d[s],e[s]);else for(s=0;6>s;++s)A(d[s],e)}}else for(e=0|e||1,s=0;6>s;++s)D(d[s],e,e);for(l(h,d[0]),h.mipmask=u.genMipmaps?(d[0].width<<1)-1:d[0].mipmask,h.internalformat=d[0].internalformat,c.width=d[0].width,c.height=d[0].height,W(h),s=0;6>s;++s)F(d[s],34069+s);for(R(u,34067),N(),f.profile&&(h.stats.size=_(h.internalformat,h.type,c.width,c.height,u.genMipmaps,!0)),c.format=el[h.internalformat],c.type=ep[h.type],c.mag=eh[u.magFilter],c.min=ed[u.minFilter],c.wrapS=em[u.wrapS],c.wrapT=em[u.wrapT],s=0;6>s;++s)L(d[s]);return c}var h=new O(34067);eb[h.id]=h,s.cubeCount++;var d=Array(6);return c(e,r,n,i,o,u),c.subimage=function(e,t,r,n,i){r|=0,n|=0,i|=0;var o=E();return l(o,h),o.width=0,o.height=0,S(o,t),o.width=o.width||(h.width>>i)-r,o.height=o.height||(h.height>>i)-n,W(h),k(o,34069+e,r,n,i),N(),C(o),c},c.resize=function(e){if((e|=0)!==h.width){c.width=h.width=e,c.height=h.height=e,W(h);for(var r=0;6>r;++r)for(var n=0;h.mipmask>>n;++n)t.texImage2D(34069+r,n,h.format,e>>n,e>>n,0,h.format,h.type,null);return N(),f.profile&&(h.stats.size=_(h.internalformat,h.type,c.width,c.height,!1,!0)),c}},c._reglType="textureCube",c._texture=h,f.profile&&(c.stats=h.stats),c.destroy=function(){h.decRef()},c},clear:function(){for(var e=0;e<e_;++e)t.activeTexture(33984+e),t.bindTexture(3553,null),ex[e]=null;q(eb).forEach(X),s.cubeCount=0,s.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<e_;++e){var r=ex[e];r&&(r.bindCount=0,r.unit=-1,ex[e]=null)}q(eb).forEach(function(e){e.texture=t.createTexture(),t.bindTexture(e.target,e.texture);for(var r=0;32>r;++r)if(0!=(e.mipmask&1<<r)){if(3553===e.target)t.texImage2D(3553,r,e.internalformat,e.width>>r,e.height>>r,0,e.internalformat,e.type,null);else for(var n=0;6>n;++n)t.texImage2D(34069+n,r,e.internalformat,e.width>>r,e.height>>r,0,e.internalformat,e.type,null)}R(e.texInfo,e.target)})}}}(e_,e3,eT,function(){ej.procs.poll()},eC,e2,e),e6=ec(e_,e3,eT,e2,e),ez=function e(t,r,n,i,o,s){function u(e,t,r){this.target=e,this.texture=t,this.renderbuffer=r;var n=e=0;t?(e=t.width,n=t.height):r&&(e=r.width,n=r.height),this.width=e,this.height=n}function f(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function c(e,t,r){e&&(e.texture?e.texture._texture.refCount+=1:e.renderbuffer._renderbuffer.refCount+=1)}function l(e,r){r&&(r.texture?t.framebufferTexture2D(36160,e,r.target,r.texture._texture.texture,0):t.framebufferRenderbuffer(36160,e,36161,r.renderbuffer._renderbuffer.renderbuffer))}function p(e){var t=3553,r=null,n=null,i=e;return"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),"texture2d"===(e=i._reglType)?r=i:"textureCube"===e?r=i:"renderbuffer"===e&&(n=i,t=36161),new u(t,r,n)}function h(e,t,r,n,s){return r?((e=i.create2D({width:e,height:t,format:n,type:s}))._texture.refCount=0,new u(3553,e,null)):((e=o.create({width:e,height:t,format:n}))._renderbuffer.refCount=0,new u(36161,null,e))}function d(e){return e&&(e.texture||e.renderbuffer)}function m(e,t,r){e&&(e.texture?e.texture.resize(t,r):e.renderbuffer&&e.renderbuffer.resize(t,r),e.width=t,e.height=r)}function $(){this.id=E++,C[this.id]=this,this.framebuffer=t.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function v(e){e.colorAttachments.forEach(f),f(e.depthAttachment),f(e.stencilAttachment),f(e.depthStencilAttachment)}function g(e){t.deleteFramebuffer(e.framebuffer),e.framebuffer=null,s.framebufferCount--,delete C[e.id]}function y(e){t.bindFramebuffer(36160,e.framebuffer);var r,i=e.colorAttachments;for(r=0;r<i.length;++r)l(36064+r,i[r]);for(r=i.length;r<n.maxColorAttachments;++r)t.framebufferTexture2D(36160,36064+r,3553,null,0);t.framebufferTexture2D(36160,33306,3553,null,0),t.framebufferTexture2D(36160,36096,3553,null,0),t.framebufferTexture2D(36160,36128,3553,null,0),l(36096,e.depthAttachment),l(36128,e.stencilAttachment),l(33306,e.depthStencilAttachment),t.checkFramebufferStatus(36160),t.isContextLost(),t.bindFramebuffer(36160,_.next?_.next.framebuffer:null),_.cur=_.next,t.getError()}function b(e,t){function r(e,t){var i,o=0,s=0,u=!0,f=!0;i=null;var l=!0,m="rgba",$="uint8",g=1,b=null,_=null,k=null,E=!1;"number"==typeof e?(o=0|e,s=0|t||o):e?("shape"in e?(o=(s=e.shape)[0],s=s[1]):("radius"in e&&(o=s=e.radius),"width"in e&&(o=e.width),"height"in e&&(s=e.height)),("color"in e||"colors"in e)&&Array.isArray(i=e.color||e.colors),!i&&("colorCount"in e&&(g=0|e.colorCount),"colorTexture"in e&&(l=!!e.colorTexture,m="rgba4"),"colorType"in e&&($=e.colorType,!l)&&("half float"===$||"float16"===$?m="rgba16f":("float"===$||"float32"===$)&&(m="rgba32f")),"colorFormat"in e&&(m=e.colorFormat,0<=w.indexOf(m)?l=!0:0<=S.indexOf(m)&&(l=!1))),("depthTexture"in e||"depthStencilTexture"in e)&&(E=!(!e.depthTexture&&!e.depthStencilTexture)),"depth"in e&&("boolean"==typeof e.depth?u=e.depth:(b=e.depth,f=!1)),"stencil"in e&&("boolean"==typeof e.stencil?f=e.stencil:(_=e.stencil,u=!1)),"depthStencil"in e&&("boolean"==typeof e.depthStencil?u=f=e.depthStencil:(k=e.depthStencil,f=u=!1))):o=s=1;var C=null,T=null,D=null,A=null;if(Array.isArray(i))C=i.map(p);else if(i)C=[p(i)];else for(C=Array(g),i=0;i<g;++i)C[i]=h(o,s,l,m,$);for(o=o||C[0].width,s=s||C[0].height,b?T=p(b):u&&!f&&(T=h(o,s,E,"depth","uint32")),_?D=p(_):f&&!u&&(D=h(o,s,!1,"stencil","uint8")),k?A=p(k):!b&&!_&&f&&u&&(A=h(o,s,E,"depth stencil","depth stencil")),u=null,i=0;i<C.length;++i)c(C[i],o,s),C[i]&&C[i].texture&&(f=el[C[i].texture._texture.format]*ep[C[i].texture._texture.type],null===u&&(u=f));return c(T,o,s),c(D,o,s),c(A,o,s),v(n),n.width=o,n.height=s,n.colorAttachments=C,n.depthAttachment=T,n.stencilAttachment=D,n.depthStencilAttachment=A,r.color=C.map(d),r.depth=d(T),r.stencil=d(D),r.depthStencil=d(A),r.width=n.width,r.height=n.height,y(n),r}var n=new $;return s.framebufferCount++,r(e,t),j(r,{resize:function(e,t){var i=Math.max(0|e,1),o=Math.max(0|t||i,1);if(i===n.width&&o===n.height)return r;for(var s=n.colorAttachments,u=0;u<s.length;++u)m(s[u],i,o);return m(n.depthAttachment,i,o),m(n.stencilAttachment,i,o),m(n.depthStencilAttachment,i,o),n.width=r.width=i,n.height=r.height=o,y(n),r},_reglType:"framebuffer",_framebuffer:n,destroy:function(){g(n),v(n)},use:function(e){_.setFBO({framebuffer:r},e)}})}var _={cur:null,next:null,dirty:!1,setFBO:null},w=["rgba"],S=["rgba4","rgb565","rgb5 a1"];r.ext_srgb&&S.push("srgba"),r.ext_color_buffer_half_float&&S.push("rgba16f","rgb16f"),r.webgl_color_buffer_float&&S.push("rgba32f");var k=["uint8"];r.oes_texture_half_float&&k.push("half float","float16"),r.oes_texture_float&&k.push("float","float32");var E=0,C={};return j(_,{getFramebuffer:function(e){return"function"==typeof e&&"framebuffer"===e._reglType&&(e=e._framebuffer)instanceof $?e:null},create:b,createCube:function(e){function t(e){var n,o={color:null},s=0,u=null;n="rgba";var f="uint8",c=1;if("number"==typeof e?s=0|e:e?("shape"in e?s=e.shape[0]:("radius"in e&&(s=0|e.radius),"width"in e?s=0|e.width:"height"in e&&(s=0|e.height)),("color"in e||"colors"in e)&&Array.isArray(u=e.color||e.colors),u||("colorCount"in e&&(c=0|e.colorCount),"colorType"in e&&(f=e.colorType),"colorFormat"in e&&(n=e.colorFormat)),"depth"in e&&(o.depth=e.depth),"stencil"in e&&(o.stencil=e.stencil),"depthStencil"in e&&(o.depthStencil=e.depthStencil)):s=1,u){if(Array.isArray(u))for(e=[],n=0;n<u.length;++n)e[n]=u[n];else e=[u]}else for(e=Array(c),u={radius:s,format:n,type:f},n=0;n<c;++n)e[n]=i.createCube(u);for(n=0,o.color=Array(e.length);n<e.length;++n)c=e[n],s=s||c.width,o.color[n]={target:34069,data:e[n]};for(n=0;6>n;++n){for(c=0;c<e.length;++c)o.color[c].target=34069+n;0<n&&(o.depth=r[0].depth,o.stencil=r[0].stencil,o.depthStencil=r[0].depthStencil),r[n]?r[n](o):r[n]=b(o)}return j(t,{width:s,height:s,color:e})}var r=Array(6);return t(e),j(t,{faces:r,resize:function(e){var n=0|e;if(n===t.width)return t;var i=t.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;6>e;++e)r[e].resize(n);return t.width=t.height=n,t},_reglType:"framebufferCube",destroy:function(){r.forEach(function(e){e.destroy()})}})},clear:function(){q(C).forEach(g)},restore:function(){_.cur=null,_.next=null,_.dirty=!0,q(C).forEach(function(e){e.framebuffer=t.createFramebuffer(),y(e)})}})}(e_,e3,eT,eF,e6,e2),ej=function e(t,r,n,o,s,u,f,c,l,p,h,m,$,v,g){function y(e){return e.replace(".","_")}function b(e,t,r){var n=y(e);er.push(e),et[n]=ee[n]=!!r,en[n]=t}function _(e,t,r){var n=y(e);er.push(e),Array.isArray(r)?(ee[n]=r.slice(),et[n]=r.slice()):ee[n]=et[n]=r,ei[n]=t}function w(){var e=function e(){function t(){var e=[],t=[];return j(function(){e.push.apply(e,S(arguments))},{def:function(){var r="v"+n++;return t.push(r),0<arguments.length&&(e.push(r,"="),e.push.apply(e,S(arguments)),e.push(";")),r},toString:function(){return k([0<t.length?"var "+t+";":"",k(e)])}})}function r(){function e(e,t){n(e,t,"=",r.def(e,t),";")}var r=t(),n=t(),i=r.toString,o=n.toString;return j(function(){r.apply(r,S(arguments))},{def:r.def,entry:r,exit:n,save:e,set:function(t,n,i){e(t,n),r(t,n,"=",i,";")},toString:function(){return i()+o()}})}var n=0,i=[],o=[],s=t(),u={};return{global:s,link:function(e){for(var t=0;t<o.length;++t)if(o[t]===e)return i[t];return t="g"+n++,i.push(t),o.push(e),t},block:t,proc:function(e,t){function n(){var e="a"+i.length;return i.push(e),e}var i=[];t=t||0;for(var o=0;o<t;++o)n();var o=r(),s=o.toString;return u[e]=j(o,{arg:n,toString:function(){return k(["function(",i.join(),"){",s(),"}"])}})},scope:r,cond:function(){var e=k(arguments),t=r(),n=r(),i=t.toString,o=n.toString;return j(t,{then:function(){return t.apply(t,S(arguments)),this},else:function(){return n.apply(n,S(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),k(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',s,"return {"];Object.keys(u).forEach(function(t){e.push('"',t,'":',u[t].toString(),",")}),e.push("}");var t=k(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,i.concat(t)).apply(null,o)}}}(),t=e.link,n=e.global;e.id=es++,e.batchId="0";var i=t(ea),o=e.shared={props:"a0"};Object.keys(ea).forEach(function(e){o[e]=n.def(i,".",e)});var s=e.next={},u=e.current={};Object.keys(ei).forEach(function(e){Array.isArray(ee[e])&&(s[e]=n.def(o.next,".",e),u[e]=n.def(o.current,".",e))});var f=e.constants={};Object.keys(eo).forEach(function(e){f[e]=n.def(JSON.stringify(eo[e]))}),e.invoke=function(r,n){switch(n.type){case 0:var i=["this",o.context,o.props,e.batchId];return r.def(t(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case 1:return r.def(o.props,n.data);case 2:return r.def(o.context,n.data);case 3:return r.def("this",n.data);case 4:return n.data.append(e,r),n.data.ref}},e.attribCache={};var c={};return e.scopeAttrib=function(e){if((e=r.id(e))in c)return c[e];var n=p.scope[e];return n||(n=p.scope[e]=new V),c[e]=t(n)},e}function z(e,t,r){var n=e.shared.context,i=e.scope();Object.keys(r).forEach(function(o){t.save(n,"."+o),i(n,".",o,"=",r[o].append(e,t),";")}),t(i)}function L(e,t,r,n){var i,o=e.shared,s=o.gl,u=o.framebuffer;Z&&(i=t.def(o.extensions,".webgl_draw_buffers"));var f=e.constants,o=f.drawBuffer,f=f.backBuffer;e=r?r.append(e,t):t.def(u,".next"),n||t("if(",e,"!==",u,".cur){"),t("if(",e,"){",s,".bindFramebuffer(",36160,",",e,".framebuffer);"),Z&&t(i,".drawBuffersWEBGL(",o,"[",e,".colorAttachments.length]);"),t("}else{",s,".bindFramebuffer(",36160,",null);"),Z&&t(i,".drawBuffersWEBGL(",f,");"),t("}",u,".cur=",e,";"),n||t("}")}function M(e,t,r){var n=e.shared,o=n.gl,s=e.current,u=e.next,f=n.current,c=n.next,l=e.cond(f,".dirty");er.forEach(function(t){if(!((t=y(t))in r.state)){var n,p;if(t in u){n=u[t],p=s[t];var h=i(ee[t].length,function(e){return l.def(n,"[",e,"]")});l(e.cond(h.map(function(e,t){return e+"!=="+p+"["+t+"]"}).join("||")).then(o,".",ei[t],"(",h,");",h.map(function(e,t){return p+"["+t+"]="+e}).join(";"),";"))}else n=l.def(c,".",t),h=e.cond(n,"!==",f,".",t),l(h),t in en?h(e.cond(n).then(o,".enable(",en[t],");").else(o,".disable(",en[t],");"),f,".",t,"=",n,";"):h(o,".",ei[t],"(",n,");",f,".",t,"=",n,";")}}),0===Object.keys(r.state).length&&l(f,".dirty=false;"),t(l)}function R(e,t,r,n){var i=e.shared,o=e.current,s=i.current,u=i.gl;C(Object.keys(r)).forEach(function(i){var f=r[i];if(!n||n(f)){var c=f.append(e,t);if(en[i]){var l=en[i];D(f)?c?t(u,".enable(",l,");"):t(u,".disable(",l,");"):t(e.cond(c).then(u,".enable(",l,");").else(u,".disable(",l,");")),t(s,".",i,"=",c,";")}else if(d(c)){var p=o[i];t(u,".",ei[i],"(",c,");",c.map(function(e,t){return p+"["+t+"]="+e}).join(";"),";")}else t(u,".",ei[i],"(",c,");",s,".",i,"=",c,";")}})}function P(e,t){J&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function O(e,t,r,n,i){function o(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function s(e){e(c=t.def(),"=",o(),";"),"string"==typeof i?e(h,".count+=",i,";"):e(h,".count++;"),v&&(n?e(l=t.def(),"=",m,".getNumPendingQueries();"):e(m,".beginQuery(",h,");"))}function u(e){e(h,".cpuTime+=",o(),"-",c,";"),v&&(n?e(m,".pushScopeStats(",l,",",m,".getNumPendingQueries(),",h,");"):e(m,".endQuery();"))}function f(e){var r=t.def(d,".profile");t(d,".profile=",e,";"),t.exit(d,".profile=",r,";")}var c,l,p=e.shared,h=e.stats,d=p.current,m=p.timer;if(r=r.profile){if(D(r)){r.enable?(s(t),u(t.exit),f("true")):f("false");return}f(r=r.append(e,t))}else r=t.def(d,".profile");s(p=e.block()),t("if(",r,"){",p,"}"),u(e=e.block()),t.exit("if(",r,"){",e,"}")}function I(e,t,r,n,i){var o=e.shared;n.forEach(function(n){var s,u=n.name,f=r.attributes[u];if(f){if(!i(f))return;s=f.append(e,t)}else{if(!i(ey))return;var c=e.scopeAttrib(u);s={},Object.keys(new V).forEach(function(e){s[e]=t.def(c,".",e)})}!function r(n,i,s){function u(){t("if(!",p,".buffer){",c,".enableVertexAttribArray(",l,");}");var r,n=s.type;r=s.size?t.def(s.size,"||",i):i,t("if(",p,".type!==",n,"||",p,".size!==",r,"||",m.map(function(e){return p+"."+e+"!=="+s[e]}).join("||"),"){",c,".bindBuffer(",34962,",",h,".buffer);",c,".vertexAttribPointer(",[l,r,n,s.normalized,s.stride,s.offset],");",p,".type=",n,";",p,".size=",r,";",m.map(function(e){return p+"."+e+"="+s[e]+";"}).join(""),"}"),J&&t("if(",p,".divisor!==",n=s.divisor,"){",e.instancing,".vertexAttribDivisorANGLE(",[l,n],");",p,".divisor=",n,";}")}function f(){t("if(",p,".buffer){",c,".disableVertexAttribArray(",l,");","}if(",eh.map(function(e,t){return p+"."+e+"!=="+d[t]}).join("||"),"){",c,".vertexAttrib4f(",l,",",d,");",eh.map(function(e,t){return p+"."+e+"="+d[t]+";"}).join(""),"}")}var c=o.gl,l=t.def(n,".location"),p=t.def(o.attributes,"[",l,"]");n=s.state;var h=s.buffer,d=[s.x,s.y,s.z,s.w],m=["buffer","normalized","offset","stride"];1===n?u():2===n?f():(t("if(",n,"===",1,"){"),u(),t("}else{"),f(),t("}"))}(e.link(n),function e(t){switch(t){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}(n.info.type),s)})}function q(e,t,n,o,s){for(var u,f=e.shared,c=f.gl,l=0;l<o.length;++l){var p,h=o[l],m=h.name,$=h.info.type,v=n.uniforms[m],h=e.link(h)+".location";if(v){if(!s(v))continue;if(D(v)){if(m=v.value,35678===$||35680===$)t(c,".uniform1i(",h,",",($=e.link(m._texture||m.color[0]._texture))+".bind());"),t.exit($,".unbind();");else if(35674===$||35675===$||35676===$)m=e.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),v=2,35675===$?v=3:35676===$&&(v=4),t(c,".uniformMatrix",v,"fv(",h,",false,",m,");");else{switch($){case 5126:u="1f";break;case 35664:u="2f";break;case 35665:u="3f";break;case 35666:u="4f";break;case 35670:case 5124:u="1i";break;case 35671:case 35667:u="2i";break;case 35672:case 35668:u="3i";break;case 35673:case 35669:u="4i"}t(c,".uniform",u,"(",h,",",d(m)?Array.prototype.slice.call(m):m,");")}continue}p=v.append(e,t)}else{if(!s(ey))continue;p=t.def(f.uniforms,"[",r.id(m),"]")}switch(35678===$?t("if(",p,"&&",p,'._reglType==="framebuffer"){',p,"=",p,".color[0];","}"):35680===$&&t("if(",p,"&&",p,'._reglType==="framebufferCube"){',p,"=",p,".color[0];","}"),m=1,$){case 35678:case 35680:$=t.def(p,"._texture"),t(c,".uniform1i(",h,",",$,".bind());"),t.exit($,".unbind();");continue;case 5124:case 35670:u="1i";break;case 35667:case 35671:u="2i",m=2;break;case 35668:case 35672:u="3i",m=3;break;case 35669:case 35673:u="4i",m=4;break;case 5126:u="1f";break;case 35664:u="2f",m=2;break;case 35665:u="3f",m=3;break;case 35666:u="4f",m=4;break;case 35674:u="Matrix2fv";break;case 35675:u="Matrix3fv";break;case 35676:u="Matrix4fv"}if(t(c,".uniform",u,"(",h,","),"M"===u.charAt(0)){var h=Math.pow($-35674+2,2),g=e.global.def("new Float32Array(",h,")");t("false,(Array.isArray(",p,")||",p," instanceof Float32Array)?",p,":(",i(h,function(e){return g+"["+e+"]="+p+"["+e+"]"}),",",g,")")}else t(1<m?i(m,function(e){return p+"["+e+"]"}):p);t(");")}}function U(e,t,r,n){function i(i){var o=v[i];return o?o.contextDep&&n.contextDynamic||o.propDep?o.append(e,r):o.append(e,t):t.def($,".",i)}function o(){function e(){r(h,".drawElementsInstancedANGLE(",[y,_,w,b+"<<(("+w+"-5121)>>1)",p],");")}function t(){r(h,".drawArraysInstancedANGLE(",[y,b,_,p],");")}g?S?e():(r("if(",g,"){"),e(),r("}else{"),t(),r("}")):t()}function s(){function e(){r(m+".drawElements("+[y,_,w,b+"<<(("+w+"-5121)>>1)"]+");")}function t(){r(m+".drawArrays("+[y,b,_]+");")}g?S?e():(r("if(",g,"){"),e(),r("}else{"),t(),r("}")):t()}var u,f,c,l,p,h,d=e.shared,m=d.gl,$=d.draw,v=n.draw,g=(u=v.elements,f=t,u?((u.contextDep&&n.contextDynamic||u.propDep)&&(f=r),u=u.append(e,f)):u=f.def($,".","elements"),u&&f("if("+u+")"+m+".bindBuffer(34963,"+u+".buffer.buffer);"),u),y=i("primitive"),b=i("offset"),_=(c=v.count,l=t,c?((c.contextDep&&n.contextDynamic||c.propDep)&&(l=r),c=c.append(e,l)):c=l.def($,".","count"),c);if("number"==typeof _){if(0===_)return}else r("if(",_,"){"),r.exit("}");J&&(p=i("instances"),h=e.instancing);var w=g+".type",S=v.elements&&D(v.elements);J&&("number"!=typeof p||0<=p)?"string"==typeof p?(r("if(",p,">0){"),o(),r("}else if(",p,"<0){"),s(),r("}")):o():s()}function H(e,t,r,n,i){return i=(t=w()).proc("body",i),J&&(t.instancing=i.def(t.shared.extensions,".angle_instanced_arrays")),e(t,i,r,n),t.compile().body}function N(e,t,r,n){P(e,t),I(e,t,r,n.attributes,function(){return!0}),q(e,t,r,n.uniforms,function(){return!0}),U(e,t,t,r)}function X(e,t,r,n){function i(){return!0}e.batchId="a1",P(e,t),I(e,t,r,n.attributes,i),q(e,t,r,n.uniforms,i),U(e,t,t,r)}function Y(e,t,r,n){function i(e){return e.contextDep&&s||e.propDep}function o(e){return!i(e)}P(e,t);var s=r.contextDep,u=t.def(),f=t.def();e.shared.props=f,e.batchId=u;var c=e.scope(),l=e.scope();t(c.entry,"for(",u,"=0;",u,"<","a1",";++",u,"){",f,"=","a0","[",u,"];",l,"}",c.exit),r.needsContext&&z(e,l,r.context),r.needsFramebuffer&&L(e,l,r.framebuffer),R(e,l,r.state,i),r.profile&&i(r.profile)&&O(e,l,r,!1,!0),n?(I(e,c,r,n.attributes,o),I(e,l,r,n.attributes,i),q(e,c,r,n.uniforms,o),q(e,l,r,n.uniforms,i),U(e,c,l,r)):(t=e.global.def("{}"),n=r.shader.progVar.append(e,l),f=l.def(n,".id"),c=l.def(t,"[",f,"]"),l(e.shared.gl,".useProgram(",n,".program);","if(!",c,"){",c,"=",t,"[",f,"]=",e.link(function(t){return H(X,e,r,t,2)}),"(",n,");}",c,".call(this,a0[",u,"],",u,");"))}function Q(e,t,r){var n=t.static[r];if(n&&function e(t){if("object"==typeof t&&!d(t)){for(var r=Object.keys(t),n=0;n<r.length;++n)if(B.isDynamic(t[r[n]]))return!0;return!1}}(n)){var i=e.global,o=Object.keys(n),s=!1,u=!1,f=!1,c=e.global.def("{}");o.forEach(function(t){var r=n[t];if(B.isDynamic(r))"function"==typeof r&&(r=n[t]=B.unbox(r)),t=F(r,null),s=s||t.thisDep,f=f||t.propDep,u=u||t.contextDep;else{switch(i(c,".",t,"="),typeof r){case"number":i(r);break;case"string":i('"',r,'"');break;case"object":Array.isArray(r)&&i("[",r.join(),"]");break;default:i(e.link(r))}i(";")}}),t.dynamic[r]=new B.DynamicVariable(4,{thisDep:s,contextDep:u,propDep:f,ref:c,append:function e(t,r){o.forEach(function(e){var i=n[e];B.isDynamic(i)&&(i=t.invoke(r,i),r(c,".",e,"=",i,";"))})}}),delete t.static[r]}}var V=p.Record,G={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(G.min=32775,G.max=32776);var J=n.angle_instanced_arrays,Z=n.webgl_draw_buffers,ee={dirty:!0,profile:g.profile},et={},er=[],en={},ei={};b("dither",3024),b("blend.enable",3042),_("blend.color","blendColor",[0,0,0,0]),_("blend.equation","blendEquationSeparate",[32774,32774]),_("blend.func","blendFuncSeparate",[1,0,1,0]),b("depth.enable",2929,!0),_("depth.func","depthFunc",513),_("depth.range","depthRange",[0,1]),_("depth.mask","depthMask",!0),_("colorMask","colorMask",[!0,!0,!0,!0]),b("cull.enable",2884),_("cull.face","cullFace",1029),_("frontFace","frontFace",2305),_("lineWidth","lineWidth",1),b("polygonOffset.enable",32823),_("polygonOffset.offset","polygonOffset",[0,0]),b("sample.alpha",32926),b("sample.enable",32928),_("sample.coverage","sampleCoverage",[1,!1]),b("stencil.enable",2960),_("stencil.mask","stencilMask",-1),_("stencil.func","stencilFunc",[519,0,-1]),_("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),_("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),b("scissor.enable",3089),_("scissor.box","scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),_("viewport","viewport",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var ea={gl:t,context:$,strings:r,next:et,current:ee,draw:m,elements:u,buffer:s,shader:h,attributes:p.state,uniforms:l,framebuffer:c,extensions:n,timer:v,isBufferArgs:E},eo={primTypes:K,compareFuncs:e$,blendFuncs:em,blendEquations:G,stencilOps:ev,glTypes:W,orientationType:eg};Z&&(eo.backBuffer=[1029],eo.drawBuffer=i(o.maxDrawbuffers,function(e){return 0===e?[0]:i(e,function(e){return 36064+e})}));var es=0;return{next:et,current:ee,procs:function(){var e,t=w(),r=t.proc("poll"),n=t.proc("refresh"),s=t.block();r(s),n(s);var u=t.shared,f=u.gl,c=u.next,l=u.current;s(l,".dirty=false;"),L(t,r),L(t,n,null,!0),J&&(e=t.link(J));for(var p=0;p<o.maxAttributes;++p){var h=n.def(u.attributes,"[",p,"]"),m=t.cond(h,".buffer");m.then(f,".enableVertexAttribArray(",p,");",f,".bindBuffer(",34962,",",h,".buffer.buffer);",f,".vertexAttribPointer(",p,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(f,".disableVertexAttribArray(",p,");",f,".vertexAttrib4f(",p,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),n(m),J&&n(e,".vertexAttribDivisorANGLE(",p,",",h,".divisor);")}return Object.keys(en).forEach(function(e){var i=en[e],o=s.def(c,".",e),u=t.block();u("if(",o,"){",f,".enable(",i,")}else{",f,".disable(",i,")}",l,".",e,"=",o,";"),n(u),r("if(",o,"!==",l,".",e,"){",u,"}")}),Object.keys(ei).forEach(function(e){var o,u,p=ei[e],h=ee[e],m=t.block();m(f,".",p,"("),d(h)?(p=h.length,o=t.global.def(c,".",e),u=t.global.def(l,".",e),m(i(p,function(e){return o+"["+e+"]"}),");",i(p,function(e){return u+"["+e+"]="+o+"["+e+"];"}).join("")),r("if(",i(p,function(e){return o+"["+e+"]!=="+u+"["+e+"]"}).join("||"),"){",m,"}")):(o=s.def(c,".",e),u=s.def(l,".",e),m(o,");",l,".",e,"=",o,";"),r("if(",o,"!==",u,"){",m,"}")),n(m)}),t.compile()}(),compile:function(e,t,n,o,f){var l,p,m,$,v,g,b,_,S,k,j,B,I,q,U,X,J,Z,ee,et,en,ei,ea,eo,es,eu,ef,ec,el,ep,ey=w();return ey.stats=ey.link(f),Object.keys(t.static).forEach(function(e){Q(ey,t,e)}),ed.forEach(function(t){Q(ey,e,t)}),n=(l=e,p=t,m=n,$=o,v=ey,j=function e(t,r){var n=t.static,i=t.dynamic;if("framebuffer"in n){var o=n.framebuffer;return o?(o=c.getFramebuffer(o),A(function(e,t){var r=e.link(o),n=e.shared;return t.set(n.framebuffer,".next",r),n=n.context,t.set(n,".framebufferWidth",r+".width"),t.set(n,".framebufferHeight",r+".height"),r})):A(function(e,t){var r=e.shared;return t.set(r.framebuffer,".next","null"),r=r.context,t.set(r,".framebufferWidth",r+".drawingBufferWidth"),t.set(r,".framebufferHeight",r+".drawingBufferHeight"),"null"})}if("framebuffer"in i){var s=i.framebuffer;return F(s,function(e,t){var r=e.invoke(t,s),n=e.shared,i=n.framebuffer,r=t.def(i,".getFramebuffer(",r,")");return t.set(i,".next",r),n=n.context,t.set(n,".framebufferWidth",r+"?"+r+".width:"+n+".drawingBufferWidth"),t.set(n,".framebufferHeight",r+"?"+r+".height:"+n+".drawingBufferHeight"),r})}return null}(l,v),B=function e(t,r,n){function i(e){if(e in o){var t=o[e];e=!0;var n,i,u=0|t.x,f=0|t.y;return"width"in t?n=0|t.width:e=!1,"height"in t?i=0|t.height:e=!1,new T(!e&&r&&r.thisDep,!e&&r&&r.contextDep,!e&&r&&r.propDep,function(e,r){var o=e.shared.context,s=n;"width"in t||(s=r.def(o,".","framebufferWidth","-",u));var c=i;return"height"in t||(c=r.def(o,".","framebufferHeight","-",f)),[u,f,s,c]})}if(e in s){var c=s[e];return e=F(c,function(e,t){var r=e.invoke(t,c),n=e.shared.context,i=t.def(r,".x|0"),o=t.def(r,".y|0"),s=t.def('"width" in ',r,"?",r,".width|0:","(",n,".","framebufferWidth","-",i,")"),r=t.def('"height" in ',r,"?",r,".height|0:","(",n,".","framebufferHeight","-",o,")");return[i,o,s,r]}),r&&(e.thisDep=e.thisDep||r.thisDep,e.contextDep=e.contextDep||r.contextDep,e.propDep=e.propDep||r.propDep),e}return r?new T(r.thisDep,r.contextDep,r.propDep,function(e,t){var r=e.shared.context;return[0,0,t.def(r,".","framebufferWidth"),t.def(r,".","framebufferHeight")]}):null}var o=t.static,s=t.dynamic;if(t=i("viewport")){var u=t;t=new T(t.thisDep,t.contextDep,t.propDep,function(e,t){var r=u.append(e,t),n=e.shared.context;return t.set(n,".viewportWidth",r[2]),t.set(n,".viewportHeight",r[3]),r})}return{viewport:t,scissor_box:i("scissor.box")}}(l,j,v),I=function e(t,r){function n(e,t){if(e in i){var r=0|i[e];return A(function(e,n){return t&&(e.OFFSET=r),r})}if(e in o){var n=o[e];return F(n,function(e,r){var i=e.invoke(r,n);return t&&(e.OFFSET=i),i})}return t&&s?A(function(e,t){return e.OFFSET="0",0}):null}var i=t.static,o=t.dynamic,s=function(){if("elements"in i){var e=i.elements;E(e)?e=u.getElements(u.create(e,!0)):e&&(e=u.getElements(e));var t=A(function(t,r){if(e){var n=t.link(e);return t.ELEMENTS=n}return t.ELEMENTS=null});return t.value=e,t}if("elements"in o){var r=o.elements;return F(r,function(e,t){var n=e.shared,i=n.isBufferArgs,n=n.elements,o=e.invoke(t,r),s=t.def("null"),i=t.def(i,"(",o,")"),o=e.cond(i).then(s,"=",n,".createStream(",o,");").else(s,"=",n,".getElements(",o,");");return t.entry(o),t.exit(e.cond(i).then(n,".destroyStream(",s,");")),e.ELEMENTS=s})}return null}(),f=n("offset",!0);return{elements:s,primitive:function(){if("primitive"in i){var e=i.primitive;return A(function(t,r){return K[e]})}if("primitive"in o){var t=o.primitive;return F(t,function(e,r){var n=e.constants.primTypes,i=e.invoke(r,t);return r.def(n,"[",i,"]")})}return s?D(s)?s.value?A(function(e,t){return t.def(e.ELEMENTS,".primType")}):A(function(){return 4}):new T(s.thisDep,s.contextDep,s.propDep,function(e,t){var r=e.ELEMENTS;return t.def(r,"?",r,".primType:",4)}):null}(),count:function(){if("count"in i){var e=0|i.count;return A(function(){return e})}if("count"in o){var t=o.count;return F(t,function(e,r){return e.invoke(r,t)})}return s?D(s)?s?f?new T(f.thisDep,f.contextDep,f.propDep,function(e,t){return t.def(e.ELEMENTS,".vertCount-",e.OFFSET)}):A(function(e,t){return t.def(e.ELEMENTS,".vertCount")}):A(function(){return -1}):new T(s.thisDep||f.thisDep,s.contextDep||f.contextDep,s.propDep||f.propDep,function(e,t){var r=e.ELEMENTS;return e.OFFSET?t.def(r,"?",r,".vertCount-",e.OFFSET,":-1"):t.def(r,"?",r,".vertCount:-1")}):null}(),instances:n("instances",!1),offset:f}}(l,v),q=(_=(g=l).static,S=g.dynamic,k={},er.forEach(function(e){function t(t,n){if(e in _){var i=t(_[e]);k[r]=A(function(){return i})}else if(e in S){var o=S[e];k[r]=F(o,function(e,t){return n(e,t,e.invoke(t,o))})}}var r=y(e);switch(e){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":return t(function(e){return e},function(e,t,r){return r});case"depth.func":return t(function(e){return e$[e]},function(e,t,r){return t.def(e.constants.compareFuncs,"[",r,"]")});case"depth.range":return t(function(e){return e},function(e,t,r){return[e=t.def("+",r,"[0]"),t=t.def("+",r,"[1]")]});case"blend.func":return t(function(e){return[em["srcRGB"in e?e.srcRGB:e.src],em["dstRGB"in e?e.dstRGB:e.dst],em["srcAlpha"in e?e.srcAlpha:e.src],em["dstAlpha"in e?e.dstAlpha:e.dst]]},function(e,t,r){function n(e,n){return t.def('"',e,n,'" in ',r,"?",r,".",e,n,":",r,".",e)}e=e.constants.blendFuncs;var i=n("src","RGB"),o=n("dst","RGB"),i=t.def(e,"[",i,"]"),s=t.def(e,"[",n("src","Alpha"),"]"),o=t.def(e,"[",o,"]");return e=t.def(e,"[",n("dst","Alpha"),"]"),[i,o,s,e]});case"blend.equation":return t(function(e){return"string"==typeof e?[G[e],G[e]]:"object"==typeof e?[G[e.rgb],G[e.alpha]]:void 0},function(e,t,r){var n=e.constants.blendEquations,i=t.def(),o=t.def();return(e=e.cond("typeof ",r,'==="string"')).then(i,"=",o,"=",n,"[",r,"];"),e.else(i,"=",n,"[",r,".rgb];",o,"=",n,"[",r,".alpha];"),t(e),[i,o]});case"blend.color":return t(function(e){return i(4,function(t){return+e[t]})},function(e,t,r){return i(4,function(e){return t.def("+",r,"[",e,"]")})});case"stencil.mask":return t(function(e){return 0|e},function(e,t,r){return t.def(r,"|0")});case"stencil.func":return t(function(e){return[e$[e.cmp||"keep"],e.ref||0,"mask"in e?e.mask:-1]},function(e,t,r){e=t.def('"cmp" in ',r,"?",e.constants.compareFuncs,"[",r,".cmp]",":",7680);var n=t.def(r,".ref|0");return t=t.def('"mask" in ',r,"?",r,".mask|0:-1"),[e,n,t]});case"stencil.opFront":case"stencil.opBack":return t(function(t){return["stencil.opBack"===e?1029:1028,ev[t.fail||"keep"],ev[t.zfail||"keep"],ev[t.zpass||"keep"]]},function(t,r,n){function i(e){return r.def('"',e,'" in ',n,"?",o,"[",n,".",e,"]:",7680)}var o=t.constants.stencilOps;return["stencil.opBack"===e?1029:1028,i("fail"),i("zfail"),i("zpass")]});case"polygonOffset.offset":return t(function(e){return[0|e.factor,0|e.units]},function(e,t,r){return[e=t.def(r,".factor|0"),t=t.def(r,".units|0")]});case"cull.face":return t(function(e){var t=0;return"front"===e?t=1028:"back"===e&&(t=1029),t},function(e,t,r){return t.def(r,'==="front"?',1028,":",1029)});case"lineWidth":return t(function(e){return e},function(e,t,r){return r});case"frontFace":return t(function(e){return eg[e]},function(e,t,r){return t.def(r+'==="cw"?2304:2305')});case"colorMask":return t(function(e){return e.map(function(e){return!!e})},function(e,t,r){return i(4,function(e){return"!!"+r+"["+e+"]"})});case"sample.coverage":return t(function(e){return["value"in e?e.value:1,!!e.invert]},function(e,t,r){return[e=t.def('"value" in ',r,"?+",r,".value:1"),t=t.def("!!",r,".invert")]})}}),k),U=function e(t){function n(e){if(e in i){var t=r.id(i[e]);return(e=A(function(){return t})).id=t,e}if(e in o){var n=o[e];return F(n,function(e,t){var r=e.invoke(t,n);return t.def(e.shared.strings,".id(",r,")")})}return null}var i=t.static,o=t.dynamic,s=n("frag"),u=n("vert"),f=null;return D(s)&&D(u)?(f=h.program(u.id,s.id),t=A(function(e,t){return e.link(f)})):t=new T(s&&s.thisDep||u&&u.thisDep,s&&s.contextDep||u&&u.contextDep,s&&s.propDep||u&&u.propDep,function(e,t){var r,n,i=e.shared.shader;return n=s?s.append(e,t):t.def(i,".","frag"),r=u?u.append(e,t):t.def(i,".","vert"),t.def(i+".program("+r+","+n+")")}),{frag:s,vert:u,progVar:t,program:f}}(l,v),(X=B.viewport)&&(q.viewport=X),(B=B[X=y("scissor.box")])&&(q[X]=B),B=0<Object.keys(q).length,(j={framebuffer:j,draw:I,shader:U,state:q,dirty:B}).profile=function e(t){var r,n=t.static;if(t=t.dynamic,"profile"in n){var i=!!n.profile;(r=A(function(e,t){return i})).enable=i}else if("profile"in t){var o=t.profile;r=F(o,function(e,t){return e.invoke(t,o)})}return r}(l,v),j.uniforms=(ee=(J=m).static,et=J.dynamic,en={},Object.keys(ee).forEach(function(e){var t,r=ee[e];if("number"==typeof r||"boolean"==typeof r)t=A(function(){return r});else if("function"==typeof r){var n=r._reglType;"texture2d"===n||"textureCube"===n?t=A(function(e){return e.link(r)}):("framebuffer"===n||"framebufferCube"===n)&&(t=A(function(e){return e.link(r.color[0])}))}else d(r)&&(t=A(function(e){return e.global.def("[",i(r.length,function(e){return r[e]}),"]")}));t.value=r,en[e]=t}),Object.keys(et).forEach(function(e){var t=et[e];en[e]=F(t,function(e,r){return e.invoke(r,t)})}),en),j.attributes=(eo=(ei=p).static,es=ei.dynamic,eu={},Object.keys(eo).forEach(function(e){var t=eo[e],n=r.id(e),i=new V;if(E(t))i.state=1,i.buffer=s.getBuffer(s.create(t,34962,!1,!0)),i.type=0;else{var o=s.getBuffer(t);if(o)i.state=1,i.buffer=o,i.type=0;else if("constant"in t){var u=t.constant;i.buffer="null",i.state=2,"number"==typeof u?i.x=u:eh.forEach(function(e,t){t<u.length&&(i[e]=u[t])})}else{var o=E(t.buffer)?s.getBuffer(s.create(t.buffer,34962,!1,!0)):s.getBuffer(t.buffer),f=0|t.offset,c=0|t.stride,l=0|t.size,p=!!t.normalized,h=0;"type"in t&&(h=W[t.type]),t=0|t.divisor,i.buffer=o,i.state=1,i.size=l,i.normalized=p,i.type=h||o.dtype,i.offset=f,i.stride=c,i.divisor=t}}eu[e]=A(function(e,t){var r=e.attribCache;if(n in r)return r[n];var o={isStream:!1};return Object.keys(i).forEach(function(e){o[e]=i[e]}),i.buffer&&(o.buffer=e.link(i.buffer),o.type=o.type||o.buffer+".dtype"),r[n]=o})}),Object.keys(es).forEach(function(e){var t=es[e];eu[e]=F(t,function(e,r){function n(e){r(f[e],"=",i,".",e,"|0;")}var i=e.invoke(r,t),o=e.shared,s=o.isBufferArgs,u=o.buffer,f={isStream:r.def(!1)},c=new V;c.state=1,Object.keys(c).forEach(function(e){f[e]=r.def(""+c[e])});var l=f.buffer,p=f.type;return r("if(",s,"(",i,")){",f.isStream,"=true;",l,"=",u,".createStream(",34962,",",i,");",p,"=",l,".dtype;","}else{",l,"=",u,".getBuffer(",i,");","if(",l,"){",p,"=",l,".dtype;",'}else if("constant" in ',i,"){",f.state,"=",2,";","if(typeof "+i+'.constant === "number"){',f[eh[0]],"=",i,".constant;",eh.slice(1).map(function(e){return f[e]}).join("="),"=0;","}else{",eh.map(function(e,t){return f[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"}).join(""),"}}else{","if(",s,"(",i,".buffer)){",l,"=",u,".createStream(",34962,",",i,".buffer);","}else{",l,"=",u,".getBuffer(",i,".buffer);","}",p,'="type" in ',i,"?",o.glTypes,"[",i,".type]:",l,".dtype;",f.normalized,"=!!",i,".normalized;"),n("size"),n("offset"),n("stride"),n("divisor"),r("}}"),r.exit("if(",f.isStream,"){",u,".destroyStream(",l,");","}"),f})}),eu),j.context=(ec=(ef=$).static,el=ef.dynamic,ep={},Object.keys(ec).forEach(function(e){var t=ec[e];ep[e]=A(function(e,r){return"number"==typeof t||"boolean"==typeof t?""+t:e.link(t)})}),Object.keys(el).forEach(function(e){var t=el[e];ep[e]=F(t,function(e,r){return e.invoke(r,t)})}),ep),j),function e(t,r){var n=t.proc("draw",1);P(t,n),z(t,n,r.context),L(t,n,r.framebuffer),M(t,n,r),R(t,n,r.state),O(t,n,r,!1,!0);var i=r.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",i,".program);"),r.shader.program)N(t,n,r,r.shader.program);else{var o=t.global.def("{}"),s=n.def(i,".id"),u=n.def(o,"[",s,"]");n(t.cond(u).then(u,".call(this,a0);").else(u,"=",o,"[",s,"]=",t.link(function(e){return H(N,t,r,e,1)}),"(",i,");",u,".call(this,a0);"))}0<Object.keys(r.state).length&&n(t.shared.current,".dirty=true;")}(ey,n),function e(t,n){function i(e){var r=n.shader[e];r&&o.set(s.shader,"."+e,r.append(t,o))}var o=t.proc("scope",3);t.batchId="a2";var s=t.shared,u=s.current;z(t,o,n.context),n.framebuffer&&n.framebuffer.append(t,o),C(Object.keys(n.state)).forEach(function(e){var r=n.state[e].append(t,o);d(r)?r.forEach(function(r,n){o.set(t.next[e],"["+n+"]",r)}):o.set(s.next,"."+e,r)}),O(t,o,n,!0,!0),["elements","offset","count","instances","primitive"].forEach(function(e){var r=n.draw[e];r&&o.set(s.draw,"."+e,""+r.append(t,o))}),Object.keys(n.uniforms).forEach(function(e){o.set(s.uniforms,"["+r.id(e)+"]",n.uniforms[e].append(t,o))}),Object.keys(n.attributes).forEach(function(e){var r=n.attributes[e].append(t,o),i=t.scopeAttrib(e);Object.keys(new V).forEach(function(e){o.set(i,"."+e,r[e])})}),i("vert"),i("frag"),0<Object.keys(n.state).length&&(o(u,".dirty=true;"),o.exit(u,".dirty=true;")),o("a1(",t.shared.context,",a0,",t.batchId,");")}(ey,n),function e(t,r){function n(e){return e.contextDep&&o||e.propDep}var i=t.proc("batch",2);t.batchId="0",P(t,i);var o=!1,s=!0;Object.keys(r.context).forEach(function(e){o=o||r.context[e].propDep}),o||(z(t,i,r.context),s=!1);var u=r.framebuffer,f=!1;if(u?(u.propDep?o=f=!0:u.contextDep&&o&&(f=!0),f||L(t,i,u)):L(t,i,null),r.state.viewport&&r.state.viewport.propDep&&(o=!0),M(t,i,r),R(t,i,r.state,function(e){return!n(e)}),r.profile&&n(r.profile)||O(t,i,r,!1,"a1"),r.contextDep=o,r.needsContext=s,r.needsFramebuffer=f,(s=r.shader.progVar).contextDep&&o||s.propDep)Y(t,i,r,null);else if(s=s.append(t,i),i(t.shared.gl,".useProgram(",s,".program);"),r.shader.program)Y(t,i,r,r.shader.program);else{var u=t.global.def("{}"),f=i.def(s,".id"),c=i.def(u,"[",f,"]");i(t.cond(c).then(c,".call(this,a0,a1);").else(c,"=",u,"[",f,"]=",t.link(function(e){return H(Y,t,r,e,2)}),"(",s,");",c,".call(this,a0,a1);"))}0<Object.keys(r.state).length&&i(t.shared.current,".dirty=true;")}(ey,n),ey.compile()}}}(e_,ew,e3,eT,eD,eA,eF,ez,{},ek,e5,{elements:null,primitive:4,count:-1,offset:0,instances:-1},eC,e4,e),ew=function e(t,r,n,i,o,s,u){function f(e){o=null===r.next?5121:r.next.colorAttachments[0].texture._texture.type;var o,s=0,u=0,f=i.framebufferWidth,c=i.framebufferHeight,l=null;return I(e)?l=e:e&&(s=0|e.x,u=0|e.y,f=0|(e.width||i.framebufferWidth-s),c=0|(e.height||i.framebufferHeight-u),l=e.data||null),n(),e=f*c*4,l||(5121===o?l=new Uint8Array(e):5126===o&&(l=l||new Float32Array(e))),t.pixelStorei(3333,4),t.readPixels(s,u,f,c,6408,o,l),l}return function(e){var t,n;return e&&"framebuffer"in e?(t=e,r.setFBO({framebuffer:t.framebuffer},function(){n=f(t)}),n):f(e)}}(e_,ez,ej.procs.poll,eC,ex,e3,eT),eL=ej.next,e7=e_.canvas,eB=[],eM=[],eR=[],eP=[e.onDestroy],eO=null;e7&&(e7.addEventListener("webglcontextlost",f,!1),e7.addEventListener("webglcontextrestored",m,!1));var eI=ez.setFBO=L({framebuffer:B.define.call(null,1,"framebuffer")});return eu(),ex=j(L,{clear:function(e){if("framebuffer"in e){if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var t=0;6>t;++t)eI(j({framebuffer:e.framebuffer.faces[t]},e),V);else eI(e,V)}else V(null,e)},prop:B.define.bind(null,1),context:B.define.bind(null,2),this:B.define.bind(null,3),draw:L({}),buffer:function(e){return eD.create(e,34962,!1,!1)},elements:function(e){return eA.create(e,!1)},texture:eF.create2D,cube:eF.createCube,renderbuffer:e6.create,framebuffer:ez.create,framebufferCube:ez.createCube,attributes:ex,frame:G,on:function(e,t){var r;switch(e){case"frame":return G(t);case"lost":r=eM;break;case"restore":r=eR;break;case"destroy":r=eP}return r.push(t),{cancel:function(){for(var e=0;e<r.length;++e)if(r[e]===t){r[e]=r[r.length-1],r.pop();break}}}},limits:eT,hasExtension:function(e){return 0<=eT.extensions.indexOf(e.toLowerCase())},read:ew,destroy:function(){eB.length=0,s(),e7&&(e7.removeEventListener("webglcontextlost",f),e7.removeEventListener("webglcontextrestored",m)),e5.clear(),ez.clear(),e6.clear(),eF.clear(),eA.clear(),eD.clear(),e4&&e4.clear(),eP.forEach(function(e){e()})},_gl:e_,_refresh:eu,poll:function(){es(),e4&&e4.update()},now:ef,stats:e2}),e.onDone(null,ex),ex}},"object"==typeof n&&void 0!==r?r.exports=o():"function"==typeof e&&e.amd?e(o):i.createREGL=o()},{}],9:[function(e,t,r){(function(e){(function(){t.exports=e.performance&&e.performance.now?function e(){return performance.now()}:Date.now||function e(){return+new Date}}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=i(e("./lib/sandbox.js"));function i(e){return e&&e.__esModule?e:{default:e}}i(e("./lib/array-utils.js"));var o=class e{constructor(e,t,r=[]){this.makeGlobal=t,this.sandbox=(0,n.default)(e),this.parent=e,Object.keys(e).forEach(e=>this.add(e)),this.userProps=r}add(e){this.makeGlobal&&(window[e]=this.parent[e])}set(e,t){this.makeGlobal&&(window[e]=t),this.parent[e]=t}tick(){this.makeGlobal&&this.userProps.forEach(e=>{this.parent[e]=window[e]})}eval(e){this.sandbox.eval(e)}};r.default=o},{"./lib/array-utils.js":20,"./lib/sandbox.js":25}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function e(t,r,n){let s=t.transform.inputs,f=t.userArgs,{generators:c}=t.synth,{src:l}=c;return s.map((e,t)=>{let n={value:e.default,type:e.type,isUniform:!1,name:e.name,vecLen:0};if("float"===n.type&&(n.value=u(e.default)),e.type.startsWith("vec"))try{n.vecLen=Number.parseInt(e.type.substr(3))}catch(s){console.log(`Error determining length of vector input type ${e.type} (${e.name})`)}if(f.length>t&&(n.value=f[t],"function"==typeof f[t]?(n.value=(r,n,i)=>{try{let o=f[t](n);if("number"==typeof o)return o;return console.warn("function does not return a number",f[t]),e.default}catch(s){return console.warn("ERROR",s),e.default}},n.isUniform=!0):f[t].constructor===Array&&(n.value=(e,r,n)=>i.default.getValue(f[t])(r),n.isUniform=!0)),r<0);else{if(n.value&&n.value.transforms){let c=n.value.transforms[n.value.transforms.length-1];if(c.transform.glsl_return_type!==e.type){let p=o[e.type];if(void 0!==p){let h=p[c.transform.glsl_return_type];if(void 0!==h){let{name:d,args:m}=h;n.value=n.value[d](...m)}}}n.isUniform=!1}else if("float"===n.type&&"number"==typeof n.value)n.value=u(n.value);else if(n.type.startsWith("vec")&&"object"==typeof n.value&&Array.isArray(n.value))n.isUniform=!1,n.value=`${n.type}(${n.value.map(u).join(", ")})`;else if("sampler2D"===e.type){var $=n.value;n.value=()=>$.getTexture(),n.isUniform=!0}else if(n.value.getTexture&&"vec4"===e.type){var v=n.value;n.value=l(v),n.isUniform=!1}n.isUniform&&(n.name+=r)}return n})};var n,i=(n=e("./lib/array-utils.js"),n&&n.__esModule?n:{default:n});let o={float:{vec4:{name:"sum",args:[[1,1,1,1]]},vec2:{name:"sum",args:[[1,1]]}}};function s(e,t){for(;e.length<t;)3===e.length?e.push(1):e.push(0);return e.slice(0,t)}let u=e=>(0>(e=e.toString()).indexOf(".")&&(e+="."),e)},{"./lib/array-utils.js":20}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function e(t){var r={uniforms:[],glslFunctions:[],fragColor:""},n=o(t,r)("st");r.fragColor=n;let i={};return r.uniforms.forEach(e=>i[e.name]=e),r.uniforms=Object.values(i),r};var n=i(e("./format-arguments.js"));function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var r=()=>"";return e.forEach(e=>{var i=(0,n.default)(e,t.uniforms.length);i.forEach(e=>{e.isUniform&&t.uniforms.push(e)}),!function e(t,r){for(var n=0;n<r.length;n++)if(t.name==r[n].name)return!0;return!1}(e,t.glslFunctions)&&t.glslFunctions.push(e);var u=r;if("src"===e.transform.type)r=r=>`${s(r,e.name,i,t)}`;else if("coord"===e.transform.type)r=r=>`${u(`${s(r,e.name,i,t)}`)}`;else if("color"===e.transform.type)r=r=>`${s(`${u(r)}`,e.name,i,t)}`;else if("combine"===e.transform.type){var f=i[0].value&&i[0].value.transforms?e=>`${o(i[0].value.transforms,t)(e)}`:i[0].isUniform?()=>i[0].name:()=>i[0].value;r=r=>`${s(`${u(r)}, ${f(r)}`,e.name,i.slice(1),t)}`}else if("combineCoord"===e.transform.type){var f=i[0].value&&i[0].value.transforms?e=>`${o(i[0].value.transforms,t)(e)}`:i[0].isUniform?()=>i[0].name:()=>i[0].value;r=r=>`${u(`${s(`${r}, ${f(r)}`,e.name,i.slice(1),t)}`)}`}}),r}function s(e,t,r,n){let i=r.map(e=>e.isUniform?e.name:e.value&&e.value.transforms?`${o(e.value.transforms,n)("st")}`:e.value).reduce((e,t)=>`${e}, ${t}`,"");return`${t}(${e}${i})`}function u(e,t){return e.concat(t.filter(function(t){return 0>e.indexOf(t)}))}i(e("./lib/array-utils.js"))},{"./format-arguments.js":11,"./lib/array-utils.js":20}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=o(e("./glsl-source.js")),i=o(e("./glsl/glsl-functions.js"));function o(e){return e&&e.__esModule?e:{default:e}}let s={src:{returnType:"vec4",args:["vec2 _st"]},coord:{returnType:"vec2",args:["vec2 _st"]},color:{returnType:"vec4",args:["vec4 _c0"]},combine:{returnType:"vec4",args:["vec4 _c0","vec4 _c1"]},combineCoord:{returnType:"vec2",args:["vec2 _st","vec4 _c0"]}};var u=class e{constructor({defaultUniforms:e,defaultOutput:t,extendTransforms:r=[],changeListener:n=()=>{}}={}){this.defaultOutput=t,this.defaultUniforms=e,this.changeListener=n,this.extendTransforms=r,this.generators={},this.init()}init(){let e=(0,i.default)();return this.glslTransforms={},this.generators=Object.entries(this.generators).reduce((e,[t,r])=>(this.changeListener({type:"remove",synth:this,method:t}),e),{}),this.sourceClass=class extends n.default{},Array.isArray(this.extendTransforms)?e.concat(this.extendTransforms):"object"==typeof this.extendTransforms&&this.extendTransforms.type&&e.push(this.extendTransforms),e.map(e=>this.setFunction(e))}_addMethod(e,t){let r=this;if(this.glslTransforms[e]=t,"src"===t.type){let n=(...n)=>new this.sourceClass({name:e,transform:t,userArgs:n,defaultOutput:this.defaultOutput,defaultUniforms:this.defaultUniforms,synth:r});return this.generators[e]=n,this.changeListener({type:"add",synth:this,method:e}),n}this.sourceClass.prototype[e]=function(...n){return this.transforms.push({name:e,transform:t,userArgs:n,synth:r}),this}}setFunction(e){var t=function e(t){let r=s[t.type];if(r){let n=r.args.map(e=>e).join(", "),i=t.inputs.map(e=>`${e.type} ${e.name}`).join(", "),o=`
  ${r.returnType} ${t.name}(${n}${i.length>0?", "+i:""}) {
      ${t.glsl}
  }
`;return("combine"===t.type||"combineCoord"===t.type)&&t.inputs.unshift({name:"color",type:"vec4"}),Object.assign({},t,{glsl:o})}console.warn(`type ${t.type} not recognized`,t)}(e);t&&this._addMethod(e.name,t)}};r.default=u},{"./glsl-source.js":14,"./glsl/glsl-functions.js":15}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=o(e("./generate-glsl.js")),i=o(e("./glsl/utility-functions.js"));function o(e){return e&&e.__esModule?e:{default:e}}var s=function(e){return this.transforms=[],this.transforms.push(e),this.defaultOutput=e.defaultOutput,this.synth=e.synth,this.type="GlslSource",this.defaultUniforms=e.defaultUniforms,this};s.prototype.addTransform=function(e){this.transforms.push(e)},s.prototype.out=function(e){var t=e||this.defaultOutput,r=this.glsl(t);if(this.synth.currentFunctions=[],t)try{t.render(r)}catch(n){console.log("shader could not compile",n)}},s.prototype.glsl=function(){var e=[],t=[];return this.transforms.forEach(e=>{"renderpass"===e.transform.type?console.warn("no support for renderpass"):t.push(e)}),t.length>0&&e.push(this.compile(t)),e},s.prototype.compile=function(e){var t=(0,n.default)(e,this.synth),r={};return t.uniforms.forEach(e=>{r[e.name]=e.value}),{frag:`
  precision ${this.defaultOutput.precision} float;
  ${Object.values(t.uniforms).map(e=>{let t=e.type;return"texture"===e.type&&(t="sampler2D"),`
      uniform ${t} ${e.name};`}).join("")}
  uniform float time;
  uniform vec2 resolution;
  varying vec2 uv;
  uniform sampler2D prevBuffer;

  ${Object.values(i.default).map(e=>`
            ${e.glsl}
          `).join("")}

  ${t.glslFunctions.map(e=>`
            ${e.transform.glsl}
          `).join("")}

  void main () {
    vec4 c = vec4(1, 0, 0, 1);
    vec2 st = gl_FragCoord.xy/resolution.xy;
    gl_FragColor = ${t.fragColor};
  }
  `,uniforms:Object.assign({},this.defaultUniforms,r)}},r.default=s},{"./generate-glsl.js":12,"./glsl/utility-functions.js":16}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=()=>[{name:"noise",type:"src",inputs:[{type:"float",name:"scale",default:10},{type:"float",name:"offset",default:.1}],glsl:"   return vec4(vec3(_noise(vec3(_st*scale, offset*time))), 1.0);"},{name:"voronoi",type:"src",inputs:[{type:"float",name:"scale",default:5},{type:"float",name:"speed",default:.3},{type:"float",name:"blending",default:.3}],glsl:`   vec3 color = vec3(.0);
   // Scale
   _st *= scale;
   // Tile the space
   vec2 i_st = floor(_st);
   vec2 f_st = fract(_st);
   float m_dist = 10.;  // minimun distance
   vec2 m_point;        // minimum point
   for (int j=-1; j<=1; j++ ) {
   for (int i=-1; i<=1; i++ ) {
   vec2 neighbor = vec2(float(i),float(j));
   vec2 p = i_st + neighbor;
   vec2 point = fract(sin(vec2(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3))))*43758.5453);
   point = 0.5 + 0.5*sin(time*speed + 6.2831*point);
   vec2 diff = neighbor + point - f_st;
   float dist = length(diff);
   if( dist < m_dist ) {
   m_dist = dist;
   m_point = point;
   }
   }
   }
   // Assign a color using the closest point position
   color += dot(m_point,vec2(.3,.6));
   color *= 1.0 - blending*m_dist;
   return vec4(color, 1.0);`},{name:"osc",type:"src",inputs:[{type:"float",name:"frequency",default:60},{type:"float",name:"sync",default:.1},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st;
   float r = sin((st.x-offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   float g = sin((st.x+time*sync)*frequency)*0.5 + 0.5;
   float b = sin((st.x+offset/frequency+time*sync)*frequency)*0.5  + 0.5;
   return vec4(r, g, b, 1.0);`},{name:"shape",type:"src",inputs:[{type:"float",name:"sides",default:3},{type:"float",name:"radius",default:.3},{type:"float",name:"smoothing",default:.01}],glsl:`   vec2 st = _st * 2. - 1.;
   // Angle and radius from the current pixel
   float a = atan(st.x,st.y)+3.1416;
   float r = (2.*3.1416)/sides;
   float d = cos(floor(.5+a/r)*r-a)*length(st);
   return vec4(vec3(1.0-smoothstep(radius,radius + smoothing + 0.0000001,d)), 1.0);`},{name:"gradient",type:"src",inputs:[{type:"float",name:"speed",default:0}],glsl:"   return vec4(_st, sin(time*speed), 1.0);"},{name:"src",type:"src",inputs:[{type:"sampler2D",name:"tex",default:NaN}],glsl:`   //  vec2 uv = gl_FragCoord.xy/vec2(1280., 720.);
   return texture2D(tex, fract(_st));`},{name:"solid",type:"src",inputs:[{type:"float",name:"r",default:0},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:1}],glsl:"   return vec4(r, g, b, a);"},{name:"rotate",type:"coord",inputs:[{type:"float",name:"angle",default:10},{type:"float",name:"speed",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float ang = angle + speed *time;
   xy = mat2(cos(ang),-sin(ang), sin(ang),cos(ang))*xy;
   xy += 0.5;
   return xy;`},{name:"scale",type:"coord",inputs:[{type:"float",name:"amount",default:1.5},{type:"float",name:"xMult",default:1},{type:"float",name:"yMult",default:1},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 xy = _st - vec2(offsetX, offsetY);
   xy*=(1.0/vec2(amount*xMult, amount*yMult));
   xy+=vec2(offsetX, offsetY);
   return xy;
   `},{name:"pixelate",type:"coord",inputs:[{type:"float",name:"pixelX",default:20},{type:"float",name:"pixelY",default:20}],glsl:`   vec2 xy = vec2(pixelX, pixelY);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"posterize",type:"color",inputs:[{type:"float",name:"bins",default:3},{type:"float",name:"gamma",default:.6}],glsl:`   vec4 c2 = pow(_c0, vec4(gamma));
   c2 *= vec4(bins);
   c2 = floor(c2);
   c2/= vec4(bins);
   c2 = pow(c2, vec4(1.0/gamma));
   return vec4(c2.xyz, _c0.a);`},{name:"shift",type:"color",inputs:[{type:"float",name:"r",default:.5},{type:"float",name:"g",default:0},{type:"float",name:"b",default:0},{type:"float",name:"a",default:0}],glsl:`   vec4 c2 = vec4(_c0);
   c2.r = fract(c2.r + r);
   c2.g = fract(c2.g + g);
   c2.b = fract(c2.b + b);
   c2.a = fract(c2.a + a);
   return vec4(c2.rgba);`},{name:"repeat",type:"coord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:0},{type:"float",name:"offsetY",default:0}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) * offsetX;
   st.y += step(1., mod(st.x,2.0)) * offsetY;
   return fract(st);`},{name:"modulateRepeat",type:"combineCoord",inputs:[{type:"float",name:"repeatX",default:3},{type:"float",name:"repeatY",default:3},{type:"float",name:"offsetX",default:.5},{type:"float",name:"offsetY",default:.5}],glsl:`   vec2 st = _st * vec2(repeatX, repeatY);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offsetX;
   st.y += step(1., mod(st.x,2.0)) + _c0.g * offsetY;
   return fract(st);`},{name:"repeatX",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatX",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.y += step(1., mod(st.x,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"repeatY",type:"coord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:0}],glsl:`   vec2 st = _st * vec2(1.0, reps);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0))* offset;
   return fract(st);`},{name:"modulateRepeatY",type:"combineCoord",inputs:[{type:"float",name:"reps",default:3},{type:"float",name:"offset",default:.5}],glsl:`   vec2 st = _st * vec2(reps, 1.0);
   //  float f =  mod(_st.y,2.0);
   st.x += step(1., mod(st.y,2.0)) + _c0.r * offset;
   return fract(st);`},{name:"kaleid",type:"coord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st;
   st -= 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return r*vec2(cos(a), sin(a));`},{name:"modulateKaleid",type:"combineCoord",inputs:[{type:"float",name:"nSides",default:4}],glsl:`   vec2 st = _st - 0.5;
   float r = length(st);
   float a = atan(st.y, st.x);
   float pi = 2.*3.1416;
   a = mod(a,pi/nSides);
   a = abs(a-pi/nSides/2.);
   return (_c0.r+r)*vec2(cos(a), sin(a));`},{name:"scroll",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"scrollY",default:.5},{type:"float",name:"speedX",default:0},{type:"float",name:"speedY",default:0}],glsl:`
   _st.x += scrollX + time*speedX;
   _st.y += scrollY + time*speedY;
   return fract(_st);`},{name:"scrollX",type:"coord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += scrollX + time*speed;
   return fract(_st);`},{name:"modulateScrollX",type:"combineCoord",inputs:[{type:"float",name:"scrollX",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.x += _c0.r*scrollX + time*speed;
   return fract(_st);`},{name:"scrollY",type:"coord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += scrollY + time*speed;
   return fract(_st);`},{name:"modulateScrollY",type:"combineCoord",inputs:[{type:"float",name:"scrollY",default:.5},{type:"float",name:"speed",default:0}],glsl:`   _st.y += _c0.r*scrollY + time*speed;
   return fract(_st);`},{name:"add",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0+_c1)*amount + _c0*(1.0-amount);"},{name:"sub",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return (_c0-_c1)*amount + _c0*(1.0-amount);"},{name:"layer",type:"combine",inputs:[],glsl:"   return vec4(mix(_c0.rgb, _c1.rgb, _c1.a), clamp(_c0.a + _c1.a, 0.0, 1.0));"},{name:"blend",type:"combine",inputs:[{type:"float",name:"amount",default:.5}],glsl:"   return _c0*(1.0-amount)+_c1*amount;"},{name:"mult",type:"combine",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _c0*(1.0-amount)+(_c0*_c1)*amount;"},{name:"diff",type:"combine",inputs:[],glsl:"   return vec4(abs(_c0.rgb-_c1.rgb), max(_c0.a, _c1.a));"},{name:"modulate",type:"combineCoord",inputs:[{type:"float",name:"amount",default:.1}],glsl:`   //  return fract(st+(_c0.xy-0.5)*amount);
   return _st + _c0.xy*amount;`},{name:"modulateScale",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:1}],glsl:`   vec2 xy = _st - vec2(0.5);
   xy*=(1.0/vec2(offset + multiple*_c0.r, offset + multiple*_c0.g));
   xy+=vec2(0.5);
   return xy;`},{name:"modulatePixelate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:10},{type:"float",name:"offset",default:3}],glsl:`   vec2 xy = vec2(offset + _c0.x*multiple, offset + _c0.y*multiple);
   return (floor(_st * xy) + 0.5)/xy;`},{name:"modulateRotate",type:"combineCoord",inputs:[{type:"float",name:"multiple",default:1},{type:"float",name:"offset",default:0}],glsl:`   vec2 xy = _st - vec2(0.5);
   float angle = offset + _c0.x * multiple;
   xy = mat2(cos(angle),-sin(angle), sin(angle),cos(angle))*xy;
   xy += 0.5;
   return xy;`},{name:"modulateHue",type:"combineCoord",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return _st + (vec2(_c0.g - _c0.r, _c0.b - _c0.g) * amount * 1.0/resolution);"},{name:"invert",type:"color",inputs:[{type:"float",name:"amount",default:1}],glsl:"   return vec4((1.0-_c0.rgb)*amount + _c0.rgb*(1.0-amount), _c0.a);"},{name:"contrast",type:"color",inputs:[{type:"float",name:"amount",default:1.6}],glsl:`   vec4 c = (_c0-vec4(0.5))*vec4(amount) + vec4(0.5);
   return vec4(c.rgb, _c0.a);`},{name:"brightness",type:"color",inputs:[{type:"float",name:"amount",default:.4}],glsl:"   return vec4(_c0.rgb + vec3(amount), _c0.a);"},{name:"mask",type:"combine",inputs:[],glsl:`   float a = _luminance(_c1.rgb);
  return vec4(_c0.rgb*a, a*_c0.a);`},{name:"luma",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.1}],glsl:`   float a = smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb));
   return vec4(_c0.rgb*a, a);`},{name:"thresh",type:"color",inputs:[{type:"float",name:"threshold",default:.5},{type:"float",name:"tolerance",default:.04}],glsl:"   return vec4(vec3(smoothstep(threshold-(tolerance+0.0000001), threshold+(tolerance+0.0000001), _luminance(_c0.rgb))), _c0.a);"},{name:"color",type:"color",inputs:[{type:"float",name:"r",default:1},{type:"float",name:"g",default:1},{type:"float",name:"b",default:1},{type:"float",name:"a",default:1}],glsl:`   vec4 c = vec4(r, g, b, a);
   vec4 pos = step(0.0, c); // detect whether negative
   // if > 0, return r * _c0
   // if < 0 return (1.0-r) * _c0
   return vec4(mix((1.0-_c0)*abs(c), c*_c0, pos));`},{name:"saturate",type:"color",inputs:[{type:"float",name:"amount",default:2}],glsl:`   const vec3 W = vec3(0.2125, 0.7154, 0.0721);
   vec3 intensity = vec3(dot(_c0.rgb, W));
   return vec4(mix(intensity, _c0.rgb, amount), _c0.a);`},{name:"hue",type:"color",inputs:[{type:"float",name:"hue",default:.4}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c.r += hue;
   //  c.r = fract(c.r);
   return vec4(_hsvToRgb(c), _c0.a);`},{name:"colorama",type:"color",inputs:[{type:"float",name:"amount",default:.005}],glsl:`   vec3 c = _rgbToHsv(_c0.rgb);
   c += vec3(amount);
   c = _hsvToRgb(c);
   c = fract(c);
   return vec4(c, _c0.a);`},{name:"prev",type:"src",inputs:[],glsl:"   return texture2D(prevBuffer, fract(_st));"},{name:"sum",type:"color",inputs:[{type:"vec4",name:"scale",default:1}],glsl:`   vec4 v = _c0 * s;
   return v.r + v.g + v.b + v.a;
   }
   float sum(vec2 _st, vec4 s) { // vec4 is not a typo, because argument type is not overloaded
   vec2 v = _st.xy * s.xy;
   return v.x + v.y;`},{name:"r",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.r * scale + offset);"},{name:"g",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.g * scale + offset);"},{name:"b",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.b * scale + offset);"},{name:"a",type:"color",inputs:[{type:"float",name:"scale",default:1},{type:"float",name:"offset",default:0}],glsl:"   return vec4(_c0.a * scale + offset);"}];r.default=n},{}],16:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n={_luminance:{type:"util",glsl:`float _luminance(vec3 rgb){
      const vec3 W = vec3(0.2125, 0.7154, 0.0721);
      return dot(rgb, W);
    }`},_noise:{type:"util",glsl:`
    //	Simplex 3D Noise
    //	by Ian McEwan, Ashima Arts
    vec4 permute(vec4 x){return mod(((x*34.0)+1.0)*x, 289.0);}
  vec4 taylorInvSqrt(vec4 r){return 1.79284291400159 - 0.85373472095314 * r;}

  float _noise(vec3 v){
    const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;
    const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);

  // First corner
    vec3 i  = floor(v + dot(v, C.yyy) );
    vec3 x0 =   v - i + dot(i, C.xxx) ;

  // Other corners
    vec3 g = step(x0.yzx, x0.xyz);
    vec3 l = 1.0 - g;
    vec3 i1 = min( g.xyz, l.zxy );
    vec3 i2 = max( g.xyz, l.zxy );

    //  x0 = x0 - 0. + 0.0 * C
    vec3 x1 = x0 - i1 + 1.0 * C.xxx;
    vec3 x2 = x0 - i2 + 2.0 * C.xxx;
    vec3 x3 = x0 - 1. + 3.0 * C.xxx;

  // Permutations
    i = mod(i, 289.0 );
    vec4 p = permute( permute( permute(
               i.z + vec4(0.0, i1.z, i2.z, 1.0 ))
             + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))
             + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));

  // Gradients
  // ( N*N points uniformly over a square, mapped onto an octahedron.)
    float n_ = 1.0/7.0; // N=7
    vec3  ns = n_ * D.wyz - D.xzx;

    vec4 j = p - 49.0 * floor(p * ns.z *ns.z);  //  mod(p,N*N)

    vec4 x_ = floor(j * ns.z);
    vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)

    vec4 x = x_ *ns.x + ns.yyyy;
    vec4 y = y_ *ns.x + ns.yyyy;
    vec4 h = 1.0 - abs(x) - abs(y);

    vec4 b0 = vec4( x.xy, y.xy );
    vec4 b1 = vec4( x.zw, y.zw );

    vec4 s0 = floor(b0)*2.0 + 1.0;
    vec4 s1 = floor(b1)*2.0 + 1.0;
    vec4 sh = -step(h, vec4(0.0));

    vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;
    vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;

    vec3 p0 = vec3(a0.xy,h.x);
    vec3 p1 = vec3(a0.zw,h.y);
    vec3 p2 = vec3(a1.xy,h.z);
    vec3 p3 = vec3(a1.zw,h.w);

  //Normalise gradients
    vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));
    p0 *= norm.x;
    p1 *= norm.y;
    p2 *= norm.z;
    p3 *= norm.w;

  // Mix final noise value
    vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);
    m = m * m;
    return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),
                                  dot(p2,x2), dot(p3,x3) ) );
  }
    `},_rgbToHsv:{type:"util",glsl:`vec3 _rgbToHsv(vec3 c){
            vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
            vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));
            vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));

            float d = q.x - min(q.w, q.y);
            float e = 1.0e-10;
            return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);
        }`},_hsvToRgb:{type:"util",glsl:`vec3 _hsvToRgb(vec3 c){
        vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
        vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
        return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }`}};r.default=n},{}],17:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=o(e("./lib/webcam.js")),i=o(e("./lib/screenmedia.js"));function o(e){return e&&e.__esModule?e:{default:e}}var s=class e{constructor({regl:e,width:t,height:r,pb:n,label:i=""}){this.label=i,this.regl=e,this.src=null,this.dynamic=!0,this.width=t,this.height=r,this.tex=this.regl.texture({shape:[1,1]}),this.pb=n}init(e,t){"src"in e&&(this.src=e.src,this.tex=this.regl.texture({data:this.src,...t})),"dynamic"in e&&(this.dynamic=e.dynamic)}initCam(e,t){let r=this;(0,n.default)(e).then(e=>{r.src=e.video,r.dynamic=!0,r.tex=r.regl.texture({data:r.src,...t})}).catch(e=>console.log("could not get camera",e))}initVideo(e="",t){let r=document.createElement("video");r.crossOrigin="anonymous",r.autoplay=!0,r.loop=!0,r.muted=!0,r.addEventListener("loadeddata",()=>{this.src=r,r.play(),this.tex=this.regl.texture({data:this.src,...t}),this.dynamic=!0}),r.src=e}initImage(e="",t){let r=document.createElement("img");r.crossOrigin="anonymous",r.src=e,r.onload=()=>{this.src=r,this.dynamic=!1,this.tex=this.regl.texture({data:this.src,...t})}}initStream(e,t){let r=this;e&&this.pb&&(this.pb.initSource(e),this.pb.on("got video",function(n,i){n===e&&(r.src=i,r.dynamic=!0,r.tex=r.regl.texture({data:r.src,...t}))}))}initScreen(e=0,t){let r=this;(0,i.default)().then(function(e){r.src=e.video,r.tex=r.regl.texture({data:r.src,...t}),r.dynamic=!0}).catch(e=>console.log("could not get screen",e))}resize(e,t){this.width=e,this.height=t}clear(){this.src&&this.src.srcObject&&this.src.srcObject.getTracks&&this.src.srcObject.getTracks().forEach(e=>e.stop()),this.src=null,this.tex=this.regl.texture({shape:[1,1]})}tick(e){null!==this.src&&!0===this.dynamic&&(this.src.videoWidth&&this.src.videoWidth!==this.tex.width&&(console.log(this.src.videoWidth,this.src.videoHeight,this.tex.width,this.tex.height),this.tex.resize(this.src.videoWidth,this.src.videoHeight)),this.src.width&&this.src.width!==this.tex.width&&this.tex.resize(this.src.width,this.src.height),this.tex.subimage(this.src))}getTexture(){return this.tex}};r.default=s},{"./lib/screenmedia.js":26,"./lib/webcam.js":28}],18:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=d(e("./output.js")),i=d(e("raf-loop")),o=d(e("./hydra-source.js")),s=d(e("./lib/mouse.js")),u=d(e("./lib/audio.js")),f=d(e("./lib/video-recorder.js")),c=d(e("./lib/array-utils.js")),l=d(e("./eval-sandbox.js")),p=d(e("./generator-factory.js")),h=d(e("regl"));function d(e){return e&&e.__esModule?e:{default:e}}let m=(0,s.default)();var $=class e{constructor({pb:e=null,width:t=1280,height:r=720,numSources:n=4,numOutputs:o=4,makeGlobal:s=!0,autoLoop:u=!0,detectAudio:p=!0,enableStreamCapture:h=!0,canvas:d,precision:$,extendTransforms:v={}}={}){if(c.default.init(),this.pb=e,this.width=t,this.height=r,this.renderAll=!1,this.detectAudio=p,this._initCanvas(d),this.synth={time:0,bpm:30,width:this.width,height:this.height,fps:void 0,stats:{fps:0},speed:1,mouse:m,render:this._render.bind(this),setResolution:this.setResolution.bind(this),update(e){},hush:this.hush.bind(this),tick:this.tick.bind(this)},s&&(window.loadScript=this.loadScript),this.timeSinceLastUpdate=0,this._time=0,$&&["lowp","mediump","highp"].includes($.toLowerCase()))this.precision=$.toLowerCase();else{let g=(/iPad|iPhone|iPod/.test(navigator.platform)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream;this.precision=g?"highp":"mediump"}if(this.extendTransforms=v,this.saveFrame=!1,this.captureStream=null,this.generator=void 0,this._initRegl(),this._initOutputs(o),this._initSources(n),this._generateGlslTransforms(),this.synth.screencap=()=>{this.saveFrame=!0},h)try{this.captureStream=this.canvas.captureStream(25),this.synth.vidRecorder=new f.default(this.captureStream)}catch(y){console.warn("[hydra-synth warning]\nnew MediaSource() is not currently supported on iOS."),console.error(y)}p&&this._initAudio(),u&&(0,i.default)(this.tick.bind(this)).start(),this.sandbox=new l.default(this.synth,s,["speed","update","bpm","fps"])}eval(e){this.sandbox.eval(e)}getScreenImage(e){this.imageCallback=e,this.saveFrame=!0}hush(){this.s.forEach(e=>{e.clear()}),this.o.forEach(e=>{this.synth.solid(0,0,0,0).out(e)}),this.synth.render(this.o[0]),this.sandbox.set("update",e=>{})}loadScript(e=""){let t=new Promise((t,r)=>{var n=document.createElement("script");n.onload=function(){console.log(`loaded script ${e}`),t()},n.onerror=r=>{console.log(`error loading script ${e}`,"log-error"),t()},n.src=e,document.head.appendChild(n)});return t}setResolution(e,t){this.canvas.width=e,this.canvas.height=t,this.width=e,this.height=t,this.sandbox.set("width",e),this.sandbox.set("height",t),console.log(this.width),this.o.forEach(r=>{r.resize(e,t)}),this.s.forEach(r=>{r.resize(e,t)}),this.regl._refresh(),console.log(this.canvas.width)}canvasToImage(e){let t=document.createElement("a");t.style.display="none";let r=new Date;t.download=`hydra-${r.getFullYear()}-${r.getMonth()+1}-${r.getDate()}-${r.getHours()}.${r.getMinutes()}.${r.getSeconds()}.png`,document.body.appendChild(t);var n=this;this.canvas.toBlob(e=>{n.imageCallback?(n.imageCallback(e),delete n.imageCallback):(t.href=URL.createObjectURL(e),console.log(t.href),t.click())},"image/png"),setTimeout(()=>{document.body.removeChild(t),window.URL.revokeObjectURL(t.href)},300)}_initAudio(){this.synth.a=new u.default({numBins:4,parentEl:this.canvas.parentNode})}_initCanvas(e){e?(this.canvas=e,this.width=e.width,this.height=e.height):(this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.imageRendering="pixelated",document.body.appendChild(this.canvas))}_initRegl(){this.regl=(0,h.default)({canvas:this.canvas,pixelRatio:1}),this.regl.clear({color:[0,0,0,1]}),this.renderAll=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform sampler2D tex0;
      uniform sampler2D tex1;
      uniform sampler2D tex2;
      uniform sampler2D tex3;

      void main () {
        vec2 st = vec2(1.0 - uv.x, uv.y);
        st*= vec2(2);
        vec2 q = floor(st).xy*(vec2(2.0, 1.0));
        int quad = int(q.x) + int(q.y);
        st.x += step(1., mod(st.y,2.0));
        st.y += step(1., mod(st.x,2.0));
        st = fract(st);
        if(quad==0){
          gl_FragColor = texture2D(tex0, st);
        } else if(quad==1){
          gl_FragColor = texture2D(tex1, st);
        } else if (quad==2){
          gl_FragColor = texture2D(tex2, st);
        } else {
          gl_FragColor = texture2D(tex3, st);
        }

      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),tex1:this.regl.prop("tex1"),tex2:this.regl.prop("tex2"),tex3:this.regl.prop("tex3")},count:3,depth:{enable:!1}}),this.renderFbo=this.regl({frag:`
      precision ${this.precision} float;
      varying vec2 uv;
      uniform vec2 resolution;
      uniform sampler2D tex0;

      void main () {
        gl_FragColor = texture2D(tex0, vec2(1.0 - uv.x, uv.y));
      }
      `,vert:`
      precision ${this.precision} float;
      attribute vec2 position;
      varying vec2 uv;

      void main () {
        uv = position;
        gl_Position = vec4(1.0 - 2.0 * position, 0, 1);
      }`,attributes:{position:[[-2,0],[0,-2],[2,2]]},uniforms:{tex0:this.regl.prop("tex0"),resolution:this.regl.prop("resolution")},count:3,depth:{enable:!1}})}_initOutputs(e){let t=this;this.o=Array(e).fill().map((e,r)=>{var i=new n.default({regl:this.regl,width:this.width,height:this.height,precision:this.precision,label:`o${r}`});return i.id=r,t.synth["o"+r]=i,i}),this.output=this.o[0]}_initSources(e){this.s=[];for(var t=0;t<e;t++)this.createSource(t)}createSource(e){let t=new o.default({regl:this.regl,pb:this.pb,width:this.width,height:this.height,label:`s${e}`});return this.synth["s"+this.s.length]=t,this.s.push(t),t}_generateGlslTransforms(){var e=this;this.generator=new p.default({defaultOutput:this.o[0],defaultUniforms:this.o[0].uniforms,extendTransforms:this.extendTransforms,changeListener({type:t,method:r,synth:n}){"add"===t&&(e.synth[r]=n.generators[r],e.sandbox&&e.sandbox.add(r))}}),this.synth.setFunction=this.generator.setFunction.bind(this.generator)}_render(e){e?(this.output=e,this.isRenderingAll=!1):this.isRenderingAll=!0}tick(e,t){if(this.sandbox.tick(),!0===this.detectAudio&&this.synth.a.tick(),this.sandbox.set("time",this.synth.time+=.001*e*this.synth.speed),this.timeSinceLastUpdate+=e,!this.synth.fps||this.timeSinceLastUpdate>=1e3/this.synth.fps){if(this.synth.stats.fps=Math.ceil(1e3/this.timeSinceLastUpdate),this.synth.update)try{this.synth.update(this.timeSinceLastUpdate)}catch(r){console.log(r)}for(let n=0;n<this.s.length;n++)this.s[n].tick(this.synth.time);for(let i=0;i<this.o.length;i++)this.o[i].tick({time:this.synth.time,mouse:this.synth.mouse,bpm:this.synth.bpm,resolution:[this.canvas.width,this.canvas.height]});this.isRenderingAll?this.renderAll({tex0:this.o[0].getCurrent(),tex1:this.o[1].getCurrent(),tex2:this.o[2].getCurrent(),tex3:this.o[3].getCurrent(),resolution:[this.canvas.width,this.canvas.height]}):this.renderFbo({tex0:this.output.getCurrent(),resolution:[this.canvas.width,this.canvas.height]}),this.timeSinceLastUpdate=0}!0===this.saveFrame&&(this.canvasToImage(),this.saveFrame=!1)}};r.default=$},{"./eval-sandbox.js":10,"./generator-factory.js":13,"./hydra-source.js":17,"./lib/array-utils.js":20,"./lib/audio.js":21,"./lib/mouse.js":24,"./lib/video-recorder.js":27,"./output.js":29,"raf-loop":6,regl:8}],19:[function(e,t,r){"use strict";var n,i=(n=e("./hydra-synth.js"),n&&n.__esModule?n:{default:n});t.exports=i.default},{"./hydra-synth.js":18}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,i=(n=e("./easing-functions.js"),n&&n.__esModule?n:{default:n}),o=(e,t,r,n,i)=>(e-t)*(i-n)/(r-t)+n;r.default={init(){Array.prototype.fast=function(e=1){return this._speed=e,this},Array.prototype.smooth=function(e=1){return this._smooth=e,this},Array.prototype.ease=function(e="linear"){return"function"==typeof e?(this._smooth=1,this._ease=e):i.default[e]&&(this._smooth=1,this._ease=i.default[e]),this},Array.prototype.offset=function(e=.5){return this._offset=e%1,this},Array.prototype.fit=function(e=0,t=1){let r=Math.min(...this),n=Math.max(...this);var i=this.map(i=>o(i,r,n,e,t));return i._speed=this._speed,i._smooth=this._smooth,i._ease=this._ease,i}},getValue:(e=[])=>({time:t,bpm:r})=>{let n=e._speed?e._speed:1,o=e._smooth?e._smooth:0,s=t*n*(r/60)+(e._offset||0);if(0===o)return e[Math.floor(s%e.length)],e[Math.floor(s%e.length)];{let u=e._ease?e._ease:i.default.linear,f=s-o/2,c=e[Math.floor(f%e.length)],l=e[Math.floor((f+1)%e.length)];return u(Math.min(f%1/o,1))*(l-c)+c}}}},{"./easing-functions.js":22}],21:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,i=(n=e("meyda"),n&&n.__esModule?n:{default:n}),o=class e{constructor({numBins:e=4,cutoff:t=2,smooth:r=.4,max:n=15,scale:o=10,isDrawing:s=!1,parentEl:u=document.body}){this.vol=0,this.scale=o,this.max=n,this.cutoff=t,this.smooth=r,this.setBins(e),this.beat={holdFrames:20,threshold:40,_cutoff:0,decay:.98,_framesSinceBeat:0},this.onBeat=()=>{},this.canvas=document.createElement("canvas"),this.canvas.width=100,this.canvas.height=80,this.canvas.style.width="100px",this.canvas.style.height="80px",this.canvas.style.position="absolute",this.canvas.style.right="0px",this.canvas.style.bottom="0px",u.appendChild(this.canvas),this.isDrawing=s,this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#DFFFFF",this.ctx.strokeStyle="#0ff",this.ctx.lineWidth=.5,window.navigator.mediaDevices&&window.navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(e=>{this.stream=e,this.context=new AudioContext;let t=this.context.createMediaStreamSource(e);this.meyda=i.default.createMeydaAnalyzer({audioContext:this.context,source:t,featureExtractors:["loudness"]})}).catch(e=>console.log("ERROR",e))}detectBeat(e){e>this.beat._cutoff&&e>this.beat.threshold?(this.onBeat(),this.beat._cutoff=1.2*e,this.beat._framesSinceBeat=0):this.beat._framesSinceBeat<=this.beat.holdFrames?this.beat._framesSinceBeat++:(this.beat._cutoff*=this.beat.decay,this.beat._cutoff=Math.max(this.beat._cutoff,this.beat.threshold))}tick(){if(this.meyda){var e=this.meyda.get();if(e&&null!==e){this.vol=e.loudness.total,this.detectBeat(this.vol);let t=(e,t)=>e+t,r=Math.floor(e.loudness.specific.length/this.bins.length);this.prevBins=this.bins.slice(0),this.bins=this.bins.map((n,i)=>e.loudness.specific.slice(i*r,(i+1)*r).reduce(t)).map((e,t)=>e*(1-this.settings[t].smooth)+this.prevBins[t]*this.settings[t].smooth),this.fft=this.bins.map((e,t)=>Math.max(0,(e-this.settings[t].cutoff)/this.settings[t].scale)),this.isDrawing&&this.draw()}}}setCutoff(e){this.cutoff=e,this.settings=this.settings.map(t=>(t.cutoff=e,t))}setSmooth(e){this.smooth=e,this.settings=this.settings.map(t=>(t.smooth=e,t))}setBins(e){this.bins=Array(e).fill(0),this.prevBins=Array(e).fill(0),this.fft=Array(e).fill(0),this.settings=Array(e).fill(0).map(()=>({cutoff:this.cutoff,scale:this.scale,smooth:this.smooth})),this.bins.forEach((e,t)=>{window["a"+t]=(e=1,r=0)=>()=>a.fft[t]*e+r})}setScale(e){this.scale=e,this.settings=this.settings.map(t=>(t.scale=e,t))}setMax(e){this.max=e,console.log("set max is deprecated")}hide(){this.isDrawing=!1,this.canvas.style.display="none"}show(){this.isDrawing=!0,this.canvas.style.display="block"}draw(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);var e=this.canvas.width/this.bins.length,t=this.canvas.height/(2*this.max);this.bins.forEach((r,n)=>{var i=r*t;this.ctx.fillRect(n*e,this.canvas.height-i,e,i);var o=this.canvas.height-t*this.settings[n].cutoff;this.ctx.beginPath(),this.ctx.moveTo(n*e,o),this.ctx.lineTo((n+1)*e,o),this.ctx.stroke();var s=this.canvas.height-t*(this.settings[n].scale+this.settings[n].cutoff);this.ctx.beginPath(),this.ctx.moveTo(n*e,s),this.ctx.lineTo((n+1)*e,s),this.ctx.stroke()})}};r.default=o},{meyda:3}],22:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0,r.default={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return e*(2-e)},easeInOutQuad:function(e){return e<.5?2*e*e:-1+(4-2*e)*e},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return--e*e*e+1},easeInOutCubic:function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1- --e*e*e*e},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1+--e*e*e*e*e},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},sin:function(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2}}},{}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;let n={};n.buttons=function e(t){if("object"==typeof t){if("buttons"in t)return t.buttons;if("which"in t){var r=t.which;if(2===r)return 4;if(3===r)return 2;if(r>0)return 1<<r-1}else if("button"in t){var r=t.button;if(1===r)return 4;if(2===r)return 2;if(r>=0)return 1<<r}}return 0},n.element=function e(t){return t.target||t.srcElement||window},n.x=function e(t){return"object"==typeof t&&"pageX"in t?t.pageX:0},n.y=function e(t){return"object"==typeof t&&"pageY"in t?t.pageY:0},r.default=n},{}],24:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n,i=(n=e("./mouse-event.js"),n&&n.__esModule?n:{default:n});r.default=function e(t,r){r||(r=t,t=window);var n=0,o=0,s=0,u={shift:!1,alt:!1,control:!1,meta:!1},f=!1;function c(e){var t=!1;return"altKey"in e&&(t=t||e.altKey!==u.alt,u.alt=!!e.altKey),"shiftKey"in e&&(t=t||e.shiftKey!==u.shift,u.shift=!!e.shiftKey),"ctrlKey"in e&&(t=t||e.ctrlKey!==u.control,u.control=!!e.ctrlKey),"metaKey"in e&&(t=t||e.metaKey!==u.meta,u.meta=!!e.metaKey),t}function l(e,t){var f=i.default.x(t),l=i.default.y(t);"buttons"in t&&(e=0|t.buttons),(e!==n||f!==o||l!==s||c(t))&&(n=0|e,o=f||0,s=l||0,r&&r(n,o,s,u))}function p(e){l(0,e)}function h(){(n||o||s||u.shift||u.alt||u.meta||u.control)&&(o=s=0,n=0,u.shift=u.alt=u.control=u.meta=!1,r&&r(0,0,0,u))}function d(e){c(e)&&r&&r(n,o,s,u)}function m(e){0===i.default.buttons(e)?l(0,e):l(n,e)}function $(e){l(n|i.default.buttons(e),e)}function v(e){l(n&~i.default.buttons(e),e)}function g(){!f&&(f=!0,t.addEventListener("mousemove",m),t.addEventListener("mousedown",$),t.addEventListener("mouseup",v),t.addEventListener("mouseleave",p),t.addEventListener("mouseenter",p),t.addEventListener("mouseout",p),t.addEventListener("mouseover",p),t.addEventListener("blur",h),t.addEventListener("keyup",d),t.addEventListener("keydown",d),t.addEventListener("keypress",d),t!==window&&(window.addEventListener("blur",h),window.addEventListener("keyup",d),window.addEventListener("keydown",d),window.addEventListener("keypress",d)))}g();var y={element:t};return Object.defineProperties(y,{enabled:{get:function(){return f},set:function(e){e?g():!!f&&(f=!1,t.removeEventListener("mousemove",m),t.removeEventListener("mousedown",$),t.removeEventListener("mouseup",v),t.removeEventListener("mouseleave",p),t.removeEventListener("mouseenter",p),t.removeEventListener("mouseout",p),t.removeEventListener("mouseover",p),t.removeEventListener("blur",h),t.removeEventListener("keyup",d),t.removeEventListener("keydown",d),t.removeEventListener("keypress",d),t!==window&&(window.removeEventListener("blur",h),window.removeEventListener("keyup",d),window.removeEventListener("keydown",d),window.removeEventListener("keypress",d)))},enumerable:!0},buttons:{get:function(){return n},enumerable:!0},x:{get:function(){return o},enumerable:!0},y:{get:function(){return s},enumerable:!0},mods:{get:function(){return u},enumerable:!0}}),y}},{"./mouse-event.js":23}],25:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=e=>{var t="",r=n(t);return{addToContext(e,i){t+=`
      var ${e} = ${i}
    `,r=n(t)},eval:e=>r.eval(e)};function n(e){return globalThis.eval(e),{eval:function(e){globalThis.eval(e)}}}};r.default=n},{}],26:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function e(t){return new Promise(function(e,r){navigator.mediaDevices.getDisplayMedia(t).then(t=>{let r=document.createElement("video");r.srcObject=t,r.addEventListener("loadedmetadata",()=>{r.play(),e({video:r})})}).catch(e=>r(e))})}},{}],27:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=class e{constructor(e){this.mediaSource=new MediaSource,this.stream=e,this.output=document.createElement("video"),this.output.autoplay=!0,this.output.loop=!0;let t=this;this.mediaSource.addEventListener("sourceopen",()=>{console.log("MediaSource opened"),t.sourceBuffer=t.mediaSource.addSourceBuffer('video/webm; codecs="vp8"'),console.log("Source buffer: ",sourceBuffer)})}start(){let e={mimeType:"video/webm;codecs=vp9"};this.recordedBlobs=[];try{this.mediaRecorder=new MediaRecorder(this.stream,e)}catch(t){console.log("Unable to create MediaRecorder with options Object: ",t);try{e={mimeType:"video/webm,codecs=vp9"},this.mediaRecorder=new MediaRecorder(this.stream,e)}catch(r){console.log("Unable to create MediaRecorder with options Object: ",r);try{e="video/vp8",this.mediaRecorder=new MediaRecorder(this.stream,e)}catch(n){alert("MediaRecorder is not supported by this browser.\n\nTry Firefox 29 or later, or Chrome 47 or later, with Enable experimental Web Platform features enabled from chrome://flags."),console.error("Exception while creating MediaRecorder:",n);return}}}console.log("Created MediaRecorder",this.mediaRecorder,"with options",e),this.mediaRecorder.onstop=this._handleStop.bind(this),this.mediaRecorder.ondataavailable=this._handleDataAvailable.bind(this),this.mediaRecorder.start(100),console.log("MediaRecorder started",this.mediaRecorder)}stop(){this.mediaRecorder.stop()}_handleStop(){let e=new Blob(this.recordedBlobs,{type:this.mediaRecorder.mimeType}),t=window.URL.createObjectURL(e);this.output.src=t;let r=document.createElement("a");r.style.display="none",r.href=t;let n=new Date;r.download=`hydra-${n.getFullYear()}-${n.getMonth()+1}-${n.getDate()}-${n.getHours()}.${n.getMinutes()}.${n.getSeconds()}.webm`,document.body.appendChild(r),r.click(),setTimeout(()=>{document.body.removeChild(r),window.URL.revokeObjectURL(t)},300)}_handleDataAvailable(e){e.data&&e.data.size>0&&this.recordedBlobs.push(e.data)}};r.default=n},{}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function e(t){return navigator.mediaDevices.enumerateDevices().then(e=>e.filter(e=>"videoinput"===e.kind)).then(e=>{let r={audio:!1,video:!0};return e[t]&&(r.video={deviceId:{exact:e[t].deviceId}}),window.navigator.mediaDevices.getUserMedia(r)}).then(e=>{let t=document.createElement("video");return t.setAttribute("autoplay",""),t.setAttribute("muted",""),t.setAttribute("playsinline",""),t.srcObject=e,new Promise((e,r)=>{t.addEventListener("loadedmetadata",()=>{t.play().then(()=>e({video:t}))})})}).catch(console.log.bind(console))}},{}],29:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=function({regl:e,precision:t,label:r="",width:n,height:i}){this.regl=e,this.precision=t,this.label=r,this.positionBuffer=this.regl.buffer([[-2,0],[0,-2],[2,2]]),this.draw=()=>{},this.init(),this.pingPongIndex=0,this.fbos=[,,].fill().map(()=>this.regl.framebuffer({color:this.regl.texture({mag:"nearest",width:n,height:i,format:"rgba"}),depthStencil:!1}))};n.prototype.resize=function(e,t){this.fbos.forEach(r=>{r.resize(e,t)})},n.prototype.getCurrent=function(){return this.fbos[this.pingPongIndex]},n.prototype.getTexture=function(){var e=this.pingPongIndex?0:1;return this.fbos[e]},n.prototype.init=function(){return this.transformIndex=0,this.fragHeader=`
  precision ${this.precision} float;

  uniform float time;
  varying vec2 uv;
  `,this.fragBody="",this.vert=`
  precision ${this.precision} float;
  attribute vec2 position;
  varying vec2 uv;

  void main () {
    uv = position;
    gl_Position = vec4(2.0 * position - 1.0, 0, 1);
  }`,this.attributes={position:this.positionBuffer},this.uniforms={time:this.regl.prop("time"),resolution:this.regl.prop("resolution")},this.frag=`
       ${this.fragHeader}

      void main () {
        vec4 c = vec4(0, 0, 0, 0);
        vec2 st = uv;
        ${this.fragBody}
        gl_FragColor = c;
      }
  `,this},n.prototype.render=function(e){let t=e[0];var r=this,n=Object.assign(t.uniforms,{prevBuffer:()=>r.fbos[r.pingPongIndex]});r.draw=r.regl({frag:t.frag,vert:r.vert,attributes:r.attributes,uniforms:n,count:3,framebuffer:()=>(r.pingPongIndex=r.pingPongIndex?0:1,r.fbos[r.pingPongIndex])})},n.prototype.tick=function(e){this.draw(e)},r.default=n},{}]},{},[19])(19)});